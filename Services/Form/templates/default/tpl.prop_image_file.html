<div class="input-group">
	<span class="input-group-btn">
		<span class="btn btn-default btn-file">
			{TXT_BROWSE}<input type="file" id="{ID}" name="{POST_VAR}"{DISABLED}/>
		</span>
	</span>
	<input tabindex="-1" type="text" class="form-control" readonly="readonly"{DISABLED}>
</div>

<!--<input type="file" id="{ID}" name="{POST_VAR}" size="30" {DISABLED}/>-->
<div class="help-block">{TXT_MAX_SIZE}</div>
<!-- BEGIN allowed_image_suffixes -->
<div class="help-block">{TXT_ALLOWED_SUFFIXES}</div>
<!-- END allowed_image_suffixes -->
<!-- BEGIN image -->
<!-- patch profile-image-patch – Killing 1.3.2021 begin -->
<div id="{POST_VAR_I}_existing_img_section">
<!-- patch profile-image-patch – Killing 1.3.2021 end -->
<img style="margin: 5px 0; max-width: 25%; height: auto;" src="{SRC_IMAGE}" alt="{ALT_IMAGE}" {WIDTH} {HEIGHT} />
<!-- BEGIN delete_bl -->
<div class="checkbox">
<label><input type="checkbox" name="{POST_VAR_D}_delete" id="{POST_VAR_D}_delete" value="1" />
	{TXT_DELETE_EXISTING}</label></div>
<!-- END delete_bl -->
<!-- BEGIN has_value -->
<input type="hidden" name="{POST_VAR_D}_name" value="{TEXT_IMAGE_NAME}" />
<!-- END has_value -->
<!-- patch profile-image-patch – Killing 1.3.2021 begin -->
</div>
<!-- patch profile-image-patch – Killing 1.3.2021 end -->
<!-- END image -->
<!-- patch profile-image-patch – Killing 1.3.2021 begin -->
<div style="margin: 10px 0px;">
	<img style="display: none; width: 200px; height: auto;" id="{POST_VAR}_capture_img" src="" alt="" />
</div>
<!-- patch profile-image-patch – Killing 1.3.2021 end -->
<!-- BEGIN pending -->
<div style="margin-bottom:3px; margin-left:3px;"><span class="subtitle">{TXT_PENDING}</span></div>
<!-- END pending -->
<!-- BEGIN capture -->
<!-- see https://gist.github.com/anantn/1852070 -->
<button class="btn btn-default" id="{POST_VAR_V}_button1">{TXT_USE_CAMERA}</button>
<button class="btn btn-default btn-primary" id="{POST_VAR_V}_button2">{TXT_TAKE_SNAPSHOT}</button>
<canvas style="display: none" id="{POST_VAR_V}_canvas"></canvas>
<input type="hidden" id="{POST_VAR_V}_capture" name="{POST_VAR_V}_capture" value="" />
<div style="margin-top: 10px;">
	<video style="display: none; width: 100px; height: auto;" id="{POST_VAR_V}_video" autoplay></video>
</div>
<script>
	$(function () {
		'use strict';
		var video = document.getElementById("{POST_VAR_V}_video")
				, canvas;
		var button1 = document.getElementById("{POST_VAR_V}_button1");
		var button2 = document.getElementById("{POST_VAR_V}_button2");

		/**
		 *  generates a still frame image from the stream in the <video>
		 *  appends the image to the <body>
		 */
		function useCamera(event) {
			event.preventDefault();
			video.style.display = "";
			button1.style.display = "none";


			// access the web cam
			navigator.mediaDevices.getUserMedia({video: true})
					// permission granted:
					.then(function (stream) {
						video.srcObject = stream;
						button2.style.display = "";
					})
					// permission denied:
					.catch(function (error) {
						//
					});
		}

		function takeSnapshot(event) {
			event.preventDefault();
			var img = document.getElementById("{POST_VAR_V}_capture_img");
			var exImg = document.getElementById("{POST_VAR_V}_existing_img_section");
			var hidden = document.getElementById("{POST_VAR_V}_capture");
			var context;
			var width = video.offsetWidth
					, height = video.offsetHeight;
			canvas = document.getElementById("{POST_VAR_V}_canvas");
			canvas.width = width * 8;
			canvas.height = height * 8;

			context = canvas.getContext('2d');
			context.drawImage(video, 0, 0, width * 8, height * 8);

			img.style.display = "";
			if (exImg) {
				exImg.style.display = "none";
			}
			img.src = canvas.toDataURL('image/png');
			img.width = width;
			img.height = height;
			hidden.value = img.src;
		}

		if (navigator.mediaDevices) {
			button1.style.display = "";
			button2.style.display = "none";
			button1.addEventListener('click', function (event) {
				useCamera(event);
			});
			button2.addEventListener('click', function (event) {
				takeSnapshot(event);
			});
		} else {
			button1.style.display = "none";
			button2.style.display = "none";
		}

	});
</script>
<!-- END capture -->

