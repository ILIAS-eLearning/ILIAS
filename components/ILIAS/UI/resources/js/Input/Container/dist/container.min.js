/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=e(t);class n{valueTransform(t){const e=t.getHtmlFields().filter((t=>t.checked));if(0===e.length)return[];const r=[];return e.forEach((t=>r.push(t.parentNode.querySelector("label").textContent))),r}}class i{#t;#e;#r;#n;#i;#s;constructor(t,e,r){this.#t=t,this.#e=e,this.#r=r,this.#n=[],this.#i=[]}getId(){return this.#r}getLabel(){return this.#t}getType(){return this.#e}addChildNode(t){this.#n.push(t)}getAllChildren(){return this.#n}addHtmlField(t){this.#i.push(t)}getHtmlFields(){return this.#i}getValues(){const t=[];return this.#i.forEach((e=>{"checkbox"===e.type||"radio"===e.type?e.checked&&t.push(e.value):t.push(e.value)})),t}setTransforms(t){this.#s=t}getChildren(){return this.#s&&this.#s.childrenTransform?this.#s.childrenTransform(this):this.getAllChildren()}getValuesRepresentation(){return this.#s&&this.#s.valueTransform?this.#s.valueTransform(this):this.getValues()}}const s="[data-il-ui-type]",l=["DependantFields"];class a{#s;#l;#a;constructor(t,e){this.#s=t,this.#l=e,this.#a=new i("form","FormContainerInput",e.getAttribute("id"));Array.from(e.querySelectorAll(s)).filter((t=>!t.parentNode.closest(s))).forEach((t=>this.#o(t,this.#a)))}#o(t,e){const r=this.#d(t),n=t.getAttribute("data-il-ui-type"),s=new i(r,n,t.getAttribute("id"));s.setTransforms(this.#u(n));this.#c(t).forEach((t=>s.addHtmlField(t)));this.#f(t).forEach((t=>this.#o(t,s))),e.addChildNode(s)}#f(t){return Array.from(t.querySelectorAll(s)).filter((e=>e.parentNode.closest(s)===t))}#c(t){return Array.from(t.querySelectorAll("[name]")).filter((e=>e.parentNode.closest(s)===t))}#d(t){let e="";const r=Array.from(t.querySelectorAll("label")).filter((e=>e.parentNode.closest(s)===t));return r.length>0&&(e=r[0].textContent),e}getNodes(){return this.#a}getNodesFlat(t,e){let r=e,n=t;r||(r=[],n=this.#a),r.push(n);const i=n.getChildren();return i.length>0&&i.forEach((t=>this.getNodesFlat(t,r))),r}getNodeById(t,e){let r=e;if(r||(r=this.#a),r.getId()===t)return r;let n=null;return r.getChildren().forEach((e=>{n=this.getNodeById(t,e)})),n}getValuesRepresentation(t,e,r){let n=t;n||(n=this.getNodes());let i=e;i||(i=0);let s=r;if(s||(s=[]),l.includes(n.getType()))i-=1;else{const t={label:n.getLabel(),value:n.getValuesRepresentation(),indent:i,type:n.getType()};s.push(t)}return n.getChildren().forEach((t=>this.getValuesRepresentation(t,i+1,s))),s}#u(t){return this.#s[t]?(console.log(`transforms found for ${t}`),this.#s[t]):null}}const o={};o.SwitchableGroupFieldInput=new class{valueTransform(t){const e=t.getChildren();if(0===e.length)return[];const r=[];return e.forEach((t=>r.push(t.getLabel()))),r}childrenTransform(t){const e=[],r=t.getAllChildren();return t.getHtmlFields().forEach(((t,n)=>{t.checked&&e.push(r[n])})),e}},o.OptionalGroupFieldInput=new class{childrenTransform(t){return t.getHtmlFields()[0].checked?t.getAllChildren():[]}},o.RadioFieldInput=new n,o.MultiSelectFieldInput=new n,o.PasswordFieldInput=new class{valueTransform(t){return null}},o.DurationFieldInput=new class{valueTransform(t){const[e,r]=t.getAllChildren().map((t=>t.getValues()[0]));return e&&r?[`${e} - ${r}`]:["-"]}childrenTransform(t){return[]}},o.LinkFieldInput=new class{valueTransform(t){const[e,r]=t.getAllChildren().map((t=>t.getValues()[0]));return[`${e} [${r}]`]}},o.SelectFieldInput=new class{valueTransform(t){const e=t.getHtmlFields()[0];return[e.options[e.options.selectedIndex].text]}},il=il||{},il.UI=il.UI||{},il.UI.filter=function(t){t((function(){t("div.il-filter").each((function(){var r=this,n=0,s=1;t(r).find(".il-standard-form").attr("action",window.location.pathname),t(r).find(".il-filter-field-status").each((function(){$hidden_input=this,"0"===t($hidden_input).val()?t(t("div.il-filter .il-popover-container")[n]).hide():t(t("div.il-filter .il-filter-add-list li")[n]).hide(),n++})),t(".il-filter-bar-opener").find("button:first").hide(),t(".il-filter-bar-opener button").click((function(){t(".il-filter-bar-opener button").toggle(),"false"==t(this).attr("aria-expanded")?t(this).attr("aria-expanded","true"):t(this).attr("aria-expanded","false")}));var l=!1;t(r).find(".il-popover-container").each((function(){var r=t(this).find(":input:not(:button)"),n=r.val(),i=t(this).find(".leftaddon").text(),a=e(r,n);""!==a?(t(".il-filter-inputs-active").find("span[id='"+s+"']").html(i+": "+a),l=!0):t(".il-filter-inputs-active").find("span[id='"+s+"']").hide(),s++})),l||t(".il-filter-inputs-active").hide(),t(".input-group .btn.btn-bulky").attr("data-placement","bottom");var a=!0;t(r).find(".il-filter-add-list").find("li").each((function(){"none"!==t(this).css("display")&&"hidden"!==t(this).css("visibility")&&(a=!1)})),a&&t(".btn-bulky").parents(".il-popover-container").hide(),t(".il-filter-field").keydown((function(e){var r=e.which;if(13===r||32===r){t(this).click();var n=i(t(this));0!=n.length&&n[0].focus(),e.preventDefault()}}))}))}));var e=function(e,r){var n="";if(e.is(":checkbox")){var i=[];e.each((function(){t(this).prop("checked")&&i.push(t(this).parent().find("span").text())})),0!=i.length&&(active_checkboxes=i.join(", "),n=active_checkboxes)}else if(e.is("select")&&""!==r){n=e.find("option:selected").text()}else void 0!==r&&""!==r&&(n=r);return n},r=function(e,r,n){t(e.parents(".il-filter").find(".il-filter-field-status").get(r)).val(n)},n=function(t){return t.parents(".il-popover-container").find(":input")},i=function(t){return t.parents(".il-popover-container").find(".il-standard-popover-content").children().children().find("input")},s=function(t){return t.parents(".il-standard-form").find(".btn-bulky").parents(".il-popover-container")};return{onInputUpdate:function(e,r){let n;var i=t(r.triggerer[0]).parents(".il-popover").attr("id");n=i?document.querySelector("span[data-target='"+i+"']"):r.triggerer[0].closest(".input-group").querySelector("span.il-filter-field"),n&&(n.innerText=r.options.string_value)},onRemoveClick:function(e,l){var a=t("#"+l),o=a.parents(".il-popover-container").index();r(a,o,"0"),a.parents(".il-popover-container").hide(),n(a).val("");var d=i(a);d.each((function(){t(this).prop("checked",!1)})),d.parents(".il-popover-container").find(".il-filter-field").html("");var u=a.parents(".input-group").find(".input-group-addon.leftaddon").html(),c=function(e,r){return e.parents(".il-standard-form").find(".btn-link").filter((function(){return t(this).text()===r})).parents("li")}(a,u);c.show();var f=s(a);0!=a.parents(".il-standard-form").find(".il-popover-container:hidden").length&&f.show()},onAddClick:function(e,l){var a=t("#"+l),o=a.text();a.parent().hide();var d=a.parent().index();r(a,d,"1");var u=function(e,r){return e.parents(".il-standard-form").find(".input-group-addon.leftaddon").filter((function(){return t(this).text()===r}))}(a,o);u.parents(".il-popover-container").show(),n(u).focus(),u.parent().find(".il-filter-field").click();var c=i(u);0!=c.length&&c[0].focus();var f=s(a);0===a.parents(".il-filter").find(".il-filter-add-list").find("li:visible").length&&f.hide(),f.find(".il-popover").hide()},onCmd:function(e,r,n){var i=t("#"+r),s=function(t){var e=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],r=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(t),n={},i=14;for(;i--;)r[i]&&(n[e[i]]=r[i]);var s=/(?:^|&)([^&=]*)=?([^&]*)/g;return n.query_params={},(n[e[12]]||"").replace(s,(function(t,e,r){e&&(n.query_params[e]=r)})),delete n.source,n}(i.parents("form").attr("data-cmd-"+n));!function(t,e){for(var r in e){var n='<input type="hidden" name="'+r+'" value="'+e[r]+'">';t.parents("form").find(".il-filter-bar").before(n)}}(i,s.query_params),i.parents("form").attr("action",s.path),i.parents("form").submit()},onAjaxCmd:function(e,r,n){var i=t("#"+r),s=i.parents("form").attr("data-cmd-"+n),l=i.parents("form").serialize();t.ajax({type:"GET",url:s+"&"+l})}}}(r.default),il.UI.Input=il.UI.Input||{},il.UI.Input.Container=new class{#h=[];#s;constructor(t){this.#s=t}init(t){const e=`#${t}`,r=document.querySelector(e);if(void 0!==this.#h[t])throw new Error(`Container with id '${t}' has already been registered.`);this.#h[t]=new a(this.#s,r)}get(t){return this.#h[t]}getAll(){return this.#h}first(){return this.#h[Object.keys(this.#h).shift()]}}(o)}($);
