/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=e(t);class r{#t;#e;#n;#r;#i;#s;constructor(t,e,n){this.#t=t,this.#e=e,this.#n=n,this.#r=[],this.#i=[]}getName(){return this.#e.split("/").pop()}getFullName(){return this.#e}getLabel(){return this.#n}getType(){return this.#t}addChildNode(t){this.#r.push(t)}getAllChildren(){return this.#r}getChildByName(t){const e=Array.from(this.#r).filter((e=>e.getName()===t));return 0===e.length?null:e.shift()}addHtmlField(t){this.#i.push(t)}getHtmlFields(){return this.#i}getValues(){const t=[];return this.#i.forEach((e=>{"checkbox"===e.type||"radio"===e.type?e.checked&&t.push(e.value):t.push(e.value)})),t}setTransforms(t){this.#s=t}getChildren(){return this.#s&&this.#s.childrenTransform?this.#s.childrenTransform(this):this.getAllChildren()}getValuesRepresentation(){return this.#s&&this.#s.valueTransform?this.#s.valueTransform(this):this.getValues()}}const i="data-il-ui-component",s="data-il-ui-input-name",l=`fieldset[${i}][ ${s}]`,a=".c-input__field";class o{#s;#l;#a;constructor(t,e){this.#s=t,this.#l=e,this.#a=new r("form","FormContainerInput",e.getAttribute("id")),Array.from(e.querySelectorAll(l)).filter((t=>t.parentNode===t.closest("form"))).forEach((t=>this.#o(this.#a,t)))}#o(t,e){const n=this.#d(e);t.addChildNode(n);const r=Array.from(e.querySelectorAll(`${a} ${l}`)).filter((t=>t.closest(a)===e.querySelector(a)));r.length>0&&r.forEach((t=>this.#o(n,t)))}#d(t){const e=t.getAttribute(i),n=t.getAttribute(s),a=t.querySelector("label").textContent.trim(),o=new r(e,n,a);return o.setTransforms(this.#u(e)),Array.from(t.querySelectorAll("[name]")).filter((e=>e.closest(l)===t)).forEach((t=>o.addHtmlField(t))),o}#u(t){return this.#s[t]?this.#s[t]:null}getNodes(){return this.#a}getNodeByName(t,e){let n=e;n||(n=this.#a);return t.split("/").slice(1).forEach((t=>(n=n.getChildByName(t),n||null))),n}getValuesRepresentation(t,e,n){let r=t;r||(r=this.getNodes());let i=e;i||(i=0);let s=n;s||(s=[]);const l={label:r.getLabel(),value:r.getValuesRepresentation(),indent:i,type:r.getType()};return s.push(l),r.getChildren().forEach((t=>this.getValuesRepresentation(t,i+1,s))),s}getNodesFlat(t,e){let n=e,r=t;n||(n=[],r=this.#a),n.push(r);const i=r.getChildren();return i.length>0&&i.forEach((t=>this.getNodesFlat(t,n))),n}}const d={"switchable-group-field-input":new class{valueTransform(t){const e=t.getChildren();if(0===e.length)return[];const n=[];return e.forEach((t=>n.push(t.getLabel()))),n}childrenTransform(t){return t.getAllChildren().filter((t=>t.getHtmlFields()[0].checked))}},"optional-roup-field-input":new class{childrenTransform(t){return t.getHtmlFields()[0].checked?t.getAllChildren():[]}},"radio-field-input":new class{valueTransform(t){const e=t.getHtmlFields().filter((t=>t.checked));if(0===e.length)return[];const n=[];return e.forEach((t=>n.push(t.nextElementSibling.textContent))),n}},"multiSelect-field-input":new class{valueTransform(t){const e=t.getHtmlFields().filter((t=>t.checked));if(0===e.length)return[];const n=[];return e.forEach((t=>n.push(t.parentNode.textContent))),n}},"password-field-input":new class{valueTransform(t){return null}},"duration-field-input":new class{valueTransform(t){const[e,n]=t.getAllChildren().map((t=>t.getValues()[0]));return e&&n?[`${e} - ${n}`]:["-"]}childrenTransform(t){return[]}},"link-field-input":new class{valueTransform(t){const[e,n]=t.getAllChildren().map((t=>t.getValues()[0]));return[`${e} [${n}]`]}},"select-field-input":new class{valueTransform(t){const e=t.getHtmlFields()[0];return[e.options[e.options.selectedIndex].text]}}};il=il||{},il.UI=il.UI||{},il.UI.filter=function(t){t((function(){t("div.il-filter").each((function(){var n=this,i=t(n).find(".il-standard-form"),l=0,o=1;i.attr("action",window.location.pathname),t(n).find(".il-filter-field-status").each((function(){$hidden_input=this,"0"===t($hidden_input).val()?t(t("div.il-filter .il-popover-container")[l]).hide():t(t("div.il-filter .il-filter-add-list li")[l]).hide(),l++})),t(".il-filter-bar-opener").find("button:first").hide(),t(".il-filter-bar-opener button").click((function(){t(".il-filter-bar-opener button").toggle(),"false"==t(this).attr("aria-expanded")?t(this).attr("aria-expanded","true"):t(this).attr("aria-expanded","false")}));var d=!1;t(n).find(".il-popover-container").each((function(){var n=t(this).find(":input:not(:button)"),r=n.val(),i=t(this).find(".leftaddon").text(),s=e(n,r);""!==s?(t(".il-filter-inputs-active").find("span[id='"+o+"']").html(i+": "+s),d=!0):t(".il-filter-inputs-active").find("span[id='"+o+"']").hide(),o++})),d||t(".il-filter-inputs-active").hide(),t(".input-group .btn.btn-bulky").attr("data-placement","bottom");var u=!0;t(n).find(".il-filter-add-list").find("li").each((function(){"none"!==t(this).css("display")&&"hidden"!==t(this).css("visibility")&&(u=!1)})),u&&t(".btn-bulky").parents(".il-popover-container").hide(),i.on("keydown",":input:not(:button)",(function(e){if(13===e.which){var n=a(i.attr("data-cmd-apply")),s=n.query_params;r(t(this),s),i.attr("action",n.path),i.submit(),e.preventDefault()}})),t(".il-filter-field").keydown((function(e){var n=e.which;if(13===n||32===n){t(this).click();var r=s(t(this));0!=r.length&&r[0].focus(),e.preventDefault()}}))}))}));var e=function(e,n){var r="";if(e.is(":checkbox")){var i=[];e.each((function(){t(this).prop("checked")&&i.push(t(this).parent().find("span").text())})),0!=i.length&&(active_checkboxes=i.join(", "),r=active_checkboxes)}else if(e.is("select")&&""!==n){r=e.find("option:selected").text()}else void 0!==n&&""!==n&&(r=n);return r},n=function(e,n,r){t(e.parents(".il-filter").find(".il-filter-field-status").get(n)).val(r)},r=function(t,e){for(var n in e){var r='<input type="hidden" name="'+n+'" value="'+e[n]+'">';t.parents("form").find(".il-filter-bar").before(r)}},i=function(t){return t.parents(".il-popover-container").find(":input")},s=function(t){return t.parents(".il-popover-container").find(".il-standard-popover-content").children().children().find("input")},l=function(t){return t.parents(".il-standard-form").find(".btn-bulky").parents(".il-popover-container")};function a(t){for(var e=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],n=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(t),r={},i=14;i--;)n[i]&&(r[e[i]]=n[i]);return r.query_params={},(r[e[12]]||"").replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,n){e&&(r.query_params[e]=n)})),delete r.source,r}return{onInputUpdate:function(e,n){let r;var i=t(n.triggerer[0]).parents(".il-popover").attr("id");r=i?document.querySelector("span[data-target='"+i+"']"):n.triggerer[0].closest(".input-group").querySelector("span.il-filter-field"),r&&(r.innerText=n.options.string_value)},onRemoveClick:function(e,r){var a=t("#"+r),o=a.parents(".il-popover-container").index();n(a,o,"0"),a.parents(".il-popover-container").hide(),i(a).val("");var d=s(a);d.each((function(){t(this).prop("checked",!1)})),d.parents(".il-popover-container").find(".il-filter-field").html("");var u=a.parents(".input-group").find(".input-group-addon.leftaddon").html(),c=function(e,n){return e.parents(".il-standard-form").find(".btn-link").filter((function(){return t(this).text()===n})).parents("li")}(a,u);c.show();var f=l(a);0!=a.parents(".il-standard-form").find(".il-popover-container:hidden").length&&f.show()},onAddClick:function(e,r){var a=t("#"+r),o=a.text();a.parent().hide();var d=a.parent().index();n(a,d,"1");var u=function(e,n){return e.parents(".il-standard-form").find(".input-group-addon.leftaddon").filter((function(){return t(this).text()===n}))}(a,o);u.parents(".il-popover-container").show(),i(u).focus(),u.parent().find(".il-filter-field").click();var c=s(u);0!=c.length&&c[0].focus();var f=l(a);0===a.parents(".il-filter").find(".il-filter-add-list").find("li:visible").length&&f.hide(),f.find(".il-popover").hide()},onCmd:function(e,n,i){var s=t("#"+n),l=a(s.parents("form").attr("data-cmd-"+i)),o=l.query_params;r(s,o),s.parents("form").attr("action",l.path),s.parents("form").submit()},onAjaxCmd:function(e,n,r){var i=t("#"+n),s=i.parents("form").attr("data-cmd-"+r),l=i.parents("form").serialize();t.ajax({type:"GET",url:s+"&"+l})}}}(n.default),il.UI.Input=il.UI.Input||{},il.UI.Input.Container=new class{#c=[];#s;constructor(t){this.#s=t}init(t){const e=`#${t}`,n=document.querySelector(e);if(void 0!==this.#c[t])throw new Error(`Container with id '${t}' has already been registered.`);this.#c[t]=new o(this.#s,n)}get(t){return this.#c[t]}getAll(){return this.#c}first(){return this.#c[Object.keys(this.#c).shift()]}}(d)}($);
