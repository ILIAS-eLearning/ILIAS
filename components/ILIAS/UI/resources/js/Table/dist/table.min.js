/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(e,t){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=s(e),o=s(t);class i{#e;#t;#s;#n;#o;#i;#a;#l;#r;constructor(e,t,s,n){if(this.#s=document.getElementById(n),null===this.#s)throw new Error(`Could not find a DataTable for id '${n}'.`);if(this.#l=this.#s.getElementsByTagName("table").item(0),null===this.#l)throw new Error("There is no <table> in the component's HTML.");this.#n=this.#s.getElementsByClassName("c-table-data__async_modal_container").item(0),this.#o=this.#s.getElementsByClassName("c-table-data__async_message").item(0),this.#i=this.#o.getElementsByClassName("c-table-data__async_messageresponse").item(0),this.#a=this.#s.querySelector(".c-table-data__dialog_container .il-dialog"),this.#e=e,this.#t={actionId:t,rowId:s},this.#r={},this.#s.addEventListener("keydown",(e=>this.navigateCellsWithArrowKeys(e)))}registerAction(e,t,s,n){this.#r[e]={async:t,urlBuilder:s,urlTokens:n}}selectAll(e){const t=this.#l.getElementsByClassName("c-table-data__row-selector"),s=this.#l.getElementsByClassName("c-table-data__selection_all").item(0),n=this.#l.getElementsByClassName("c-table-data__selection_none").item(0);for(let s=0;s<t.length;s+=1){t[s].checked=e}e?(s.style.display="none",n.style.display="block"):(s.style.display="block",n.style.display="none")}collectSelectedRowIds(){const e=this.#l.getElementsByClassName("c-table-data__row-selector"),t=[];return e.forEach((e=>{e.checked&&t.push(e.value)})),t}doMultiAction(e){this.doAction(e,this.collectSelectedRowIds())}doSingleAction(e){const t=e.options[this.#t.rowId];this.doAction(e,[t])}doActionForAll(e){const t=e.parentNode.parentNode,s=t.getElementsByClassName("close").item(0),n=t.getElementsByClassName("modal-body")[0].getElementsByTagName("select")[0].value;if(n in this.#r){const e=this.#t.actionId,t={options:{}};t.options[e]=n,s.click(),this.doAction(t,["ALL_OBJECTS"])}}doAction(e,t){const s=e.options[this.#t.actionId],n=this.#r[s],o=n.urlTokens.values().next().value;n.urlBuilder.writeParameter(o,t);const i=decodeURI(n.urlBuilder.getUrl().toString());"none"===n.async?window.location.href=i:"dialog"===n.async?il.UI.dialog.get(this.#a.id).show(i):this.asyncAction(i)}asyncAction(e){this.#e.ajax({url:e,dataType:"html"}).done((e=>{let t="";if("SCRIPT"===this.#e(e).first().prop("tagName"))this.#e.globalEval(this.#e(e).first().text());else{this.#e(e).first().hasClass("c-modal")?(this.#n.innerHTML=e,t=this.#e(e).first().get(0).id):(this.#i.innerHTML=e,t=this.#o.id);this.#e(`<div>${e}</div>`).find("[data-replace-marker='script']").each(((e,t)=>this.#e.globalEval(t.innerHTML))),il.UI.modal.showModal(t,{},{id:t})}}))}navigateCellsWithArrowKeys(e){if(37!==e.which&&38!==e.which&&39!==e.which&&40!==e.which)return;const t=e.target.closest("td, th"),s=t.closest("tr");let{cellIndex:n}=t,{rowIndex:o}=s;switch(e.which){case 37:n-=1;break;case 39:n+=1;break;case 38:o-=1;break;case 40:o+=1}o<0||n<0||o>=this.#l.rows.length||n>=s.cells.length||this.focusCell(t,o,n)}focusCell(e,t,s){const n=this.#l.rows[t].cells[s];n.focus(),e.setAttribute("tabindex",-1),n.setAttribute("tabindex",0)}}class a{#s;constructor(e){if(this.#s=document.getElementById(e),null===this.#s)throw new Error(`Could not find a PresentationTable for id '${e}'.`)}expandRow(e){this.#s.querySelector(`#${e} .il-table-presentation-row-controls-expander`).style.display="none",this.#s.querySelector(`#${e} .il-table-presentation-row-controls-collapser`).style.display="block",this.#s.querySelector(`#${e} .il-table-presentation-row-expanded`).style.display="block",this.#s.querySelector(`#${e} .il-table-presentation-row-header-fields`).style.display="none",this.#s.classList.remove("collapsed"),this.#s.classList.add("expanded")}collapseRow(e){this.#s.querySelector(`#${e} .il-table-presentation-row-controls-expander`).style.display="block",this.#s.querySelector(`#${e} .il-table-presentation-row-controls-collapser`).style.display="none",this.#s.querySelector(`#${e} .il-table-presentation-row-expanded`).style.display="none",this.#s.querySelector(`#${e} .il-table-presentation-row-header-fields`).style.display="block",this.#s.classList.remove("expanded"),this.#s.classList.add("collapsed")}toggleRow(e){const t=[this.#s.querySelector(`#${e} .il-table-presentation-row-controls-expander`),this.#s.querySelector(`#${e} .il-table-presentation-row-controls-collapser`),this.#s.querySelector(`#${e} .il-table-presentation-row-expanded`),this.#s.querySelector(`#${e} .il-table-presentation-row-header-fields`)];let s=0;for(;s<t.length;s+=1){const e=t[s],n="none"===e.style.display?"block":"none";e.style.display=n}this.#s.classList.contains("expanded")?(this.#s.classList.remove("expanded"),this.#s.classList.add("collapsed")):(this.#s.classList.remove("collapsed"),this.#s.classList.add("expanded"))}expandAll(e){const t=this.#s.querySelectorAll(".il-table-presentation-row");e.options.expand?t.forEach((e=>this.expandRow(e.id))):t.forEach((e=>this.collapseRow(e.id)))}}class l{#s;#l;#c;#d;constructor(e){if(this.#s=document.getElementById(e),null===this.#s)throw new Error(`Could not find a OrderingTable for id '${e}'.`);if(this.#l=this.#s.getElementsByTagName("table").item(0),null===this.#l)throw new Error("There is no <table> in the component's HTML.");this.#h(),this.#c.forEach((e=>this.#p(e)))}#h(){this.#c=Array.from(this.#l.rows),this.#c.shift(),this.#c.pop()}#p(e){e.setAttribute("draggable",!0),e.addEventListener("dragstart",(e=>this.dragstart(e))),e.addEventListener("dragover",(e=>this.dragover(e))),e.addEventListener("dragend",(()=>{this.#h(),this.#m()}))}dragstart(e){this.#d=e.target}#u(){return this.#c.includes(this.#d)}dragover(e){if(!this.#u())return;const t=e;t.preventDefault();const s=t.target.closest("tr");this.#c.indexOf(s)>this.#c.indexOf(this.#d)?s.after(this.#d):s.before(this.#d)}#m(){let e=10;this.#l.querySelectorAll('input[type="number"]').forEach((t=>{t.value=e,e+=10}))}}n.default.UI=n.default.UI||{},n.default.UI.table=n.default.UI.table||{},n.default.UI.table.data=new class{#e;#y=[];constructor(e){this.#e=e}init(e,t,s){if(void 0!==this.#y[e])throw new Error(`DataTable with id '${e}' has already been initialized.`);this.#y[e]=new i(this.#e,t,s,e)}get(e){return this.#y[e]??null}}(o.default),n.default.UI.table.presentation=new class{#y=[];init(e){if(void 0!==this.#y[e])throw new Error(`PresentationTable with input-id '${e}' has already been initialized.`);this.#y[e]=new a(e)}get(e){return this.#y[e]??null}},n.default.UI.table.ordering=new class{#y=[];init(e){if(void 0!==this.#y[e])throw new Error(`OrderingTable with id '${e}' has already been initialized.`);this.#y[e]=new l(e)}get(e){return this.#y[e]??null}}}(il,$);
