/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(t,e){"use strict";class s{#t;#e;#s;#n;#i;#o;#a;#r;#l;constructor(t,e,s,n){if(this.#s=document.getElementById(n),null===this.#s)throw new Error(`Could not find a DataTable for id '${n}'.`);if(this.#r=this.#s.getElementsByTagName("table").item(0),null===this.#r)throw new Error("There is no <table> in the component's HTML.");this.#n=this.#s.getElementsByClassName("c-table-data__async_modal_container").item(0),this.#i=this.#s.getElementsByClassName("c-table-data__async_message").item(0),this.#o=this.#i.getElementsByClassName("c-table-data__async_messageresponse").item(0),this.#a=this.#s.querySelector(".c-table-data__dialog_container .il-prompt"),this.#t=t,this.#e={actionId:e,rowId:s},this.#l={},this.#s.addEventListener("keydown",(t=>this.navigateCellsWithArrowKeys(t)))}registerAction(t,e,s,n){this.#l[t]={async:e,urlBuilder:s,urlTokens:n}}selectAll(t){const e=this.#r.getElementsByClassName("c-table-data__row-selector"),s=this.#r.getElementsByClassName("c-table-data__selection_all").item(0),n=this.#r.getElementsByClassName("c-table-data__selection_none").item(0);for(let s=0;s<e.length;s+=1){e[s].checked=t}t?(s.style.display="none",n.style.display="block"):(s.style.display="block",n.style.display="none")}collectSelectedRowIds(){const t=this.#r.getElementsByClassName("c-table-data__row-selector"),e=[];return t.forEach((t=>{t.checked&&e.push(t.value)})),e}doMultiAction(t){this.doAction(t,this.collectSelectedRowIds())}doSingleAction(t){const e=t.options[this.#e.rowId];this.doAction(t,[e])}doActionForAll(t){const e=t.parentNode.parentNode.parentNode,s=e.getElementsByClassName("close").item(0),n=e.getElementsByClassName("modal-body")[0].getElementsByTagName("select")[0].value;if(n in this.#l){const t=this.#e.actionId,e={options:{}};e.options[t]=n,s.click(),this.doAction(e,["ALL_OBJECTS"])}}doAction(t,e){const s=t.options[this.#e.actionId],n=this.#l[s],i=n.urlTokens.values().next().value;n.urlBuilder.writeParameter(i,e);const o=decodeURI(n.urlBuilder.getUrl().toString());"none"===n.async?window.location.href=o:"prompt"===n.async?il.UI.prompt.get(this.#a.id).show(o):this.asyncAction(o)}asyncAction(t){this.#t.ajax({url:t,dataType:"html"}).done((t=>{if("SCRIPT"===this.#t(t).first().prop("tagName"))this.#t.globalEval(this.#t(t).first().text());else{let e;this.#t(t).first().hasClass("c-modal")?(this.#n.innerHTML=t,e=this.#n.firstChild):(this.#o.innerHTML=t,e=this.#i);this.#t(`<div>${t}</div>`).find("[data-replace-marker='script']").each(((t,e)=>this.#t.globalEval(e.innerHTML))),il.UI.modal.showModal(e,{},{id:e.id})}}))}navigateCellsWithArrowKeys(t){if(37!==t.which&&38!==t.which&&39!==t.which&&40!==t.which)return;const e=t.target.closest("td, th"),s=e.closest("tr");let{cellIndex:n}=e,{rowIndex:i}=s;switch(t.which){case 37:n-=1;break;case 39:n+=1;break;case 38:i-=1;break;case 40:i+=1}i<0||n<0||i>=this.#r.rows.length||n>=s.cells.length||this.focusCell(e,i,n)}focusCell(t,e,s){const n=this.#r.rows[e].cells[s];n.focus(),t.setAttribute("tabindex",-1),n.setAttribute("tabindex",0)}}class n{#s;constructor(t){if(this.#s=document.getElementById(t),null===this.#s)throw new Error(`Could not find a PresentationTable for id '${t}'.`)}expandRow(t){const e=this.#s.querySelector(`#${t}`);e.classList.remove("collapsed"),e.classList.add("expanded")}collapseRow(t){const e=this.#s.querySelector(`#${t}`);e.classList.remove("expanded"),e.classList.add("collapsed")}toggleRow(t){this.#s.querySelector(`#${t}`).classList.contains("expanded")?this.collapseRow(t):this.expandRow(t)}expandAll(t){const e=this.#s.querySelectorAll(".il-table-presentation-row");t.options.expand?e.forEach((t=>this.expandRow(t.id))):e.forEach((t=>this.collapseRow(t.id)))}}class i{#s;#r;#c;#d;constructor(t){if(this.#s=document.getElementById(t),null===this.#s)throw new Error(`Could not find a OrderingTable for id '${t}'.`);if(this.#r=this.#s.getElementsByTagName("table").item(0),null===this.#r)throw new Error("There is no <table> in the component's HTML.");this.#h(),this.#c.forEach((t=>this.#m(t)))}#h(){this.#c=Array.from(this.#r.rows),this.#c.shift(),this.#c.pop()}#m(t){t.setAttribute("draggable",!0),t.addEventListener("dragstart",(t=>this.dragstart(t))),t.addEventListener("dragover",(t=>this.dragover(t))),t.addEventListener("dragend",(()=>{this.#h(),this.#p()}))}dragstart(t){this.#d=t.target}#g(){return this.#c.includes(this.#d)}dragover(t){if(!this.#g())return;const e=t;e.preventDefault();const s=e.target.closest("tr");this.#c.indexOf(s)>this.#c.indexOf(this.#d)?s.after(this.#d):s.before(this.#d)}#p(){let t=10;this.#r.querySelectorAll('input[type="number"]').forEach((e=>{e.value=t,t+=10}))}}t.UI=t.UI||{},t.UI.table=t.UI.table||{},t.UI.table.data=new class{#t;#w=[];constructor(t){this.#t=t}init(t,e,n){if(void 0!==this.#w[t])throw new Error(`DataTable with id '${t}' has already been initialized.`);this.#w[t]=new s(this.#t,e,n,t)}get(t){return this.#w[t]??null}}(e),t.UI.table.presentation=new class{#w=[];init(t){if(void 0!==this.#w[t])throw new Error(`PresentationTable with input-id '${t}' has already been initialized.`);this.#w[t]=new n(t)}get(t){return this.#w[t]??null}},t.UI.table.ordering=new class{#w=[];init(t){if(void 0!==this.#w[t])throw new Error(`OrderingTable with id '${t}' has already been initialized.`);this.#w[t]=new i(t)}get(t){return this.#w[t]??null}}}(il,$);
