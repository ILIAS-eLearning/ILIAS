/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=t(e);class n{#e;#t;#i;constructor(e){this.#e=e,this.#t=[],this.#i=[]}addNode(e){this.#t[e.getName()]=e}addField(e){this.#i.push(e)}getName(){return this.#e}getNodes(){return this.#t}getNodeNames(){return Object.keys(this.#t)}getNodeByName(e){return this.#t[e]}getFields(){return this.#i}getValues(){const e=[];return this.#i.forEach((t=>{"checkbox"===t.type||"radio"===t.type?t.checked&&e.push(t.value):e.push(t.value)})),e}#n(){let e=this.getNodeNames();if(this.getFields().length>0&&0===this.getValues().length&&(e=[]),this.getFields().length>0&&this.getFields().filter((e=>"radio"===e.type)).length===this.getFields().length){e=[];const t=this.getFields().findIndex((e=>e.value===this.getValues().shift()));this.getNodeNames().length>t&&t>-1&&(e=[this.getNodeNames()[t]])}return e}getValuesRecursively(e){const t=e||[];t[this.getName()]=this.getValues();return this.#n().forEach((e=>this.getNodeByName(e).getValuesRecursively(t[this.getName()]))),t}getValuesFlat(e,t){const i=e||[],n=t||[this.getName()];i[n.join("/")]=this.getValues();return this.#n().forEach((e=>this.getNodeByName(e).getValuesFlat(i,n.concat([e])))),i}}class r{#r;#t;constructor(e){this.#r=e,this.#t=new n("root"),this.#s()}#s(){this.#r.querySelectorAll("[name]").forEach((e=>{this.#a(this.#t,e.name.split("/"),e)}))}#a(e,t,i){let r=e;const s=t.shift();r.getNodeNames().includes(s)||r.addNode(new n(s)),r=r.getNodeByName(s),t.length>0?this.#a(r,t,i):r.addField(i)}node(e){let t=this.#t;return""===e||void 0===e?t.getNodeByName(t.getNodeNames().shift()):(e.split("/").forEach((e=>{t=t.getNodeByName(e)})),t)}getValues(e){return this.node(e).getValuesRecursively()}getValuesFlat(e){return this.node(e).getValuesFlat()}}il=il||{},il.UI=il.UI||{},il.UI.filter=function(e){e((function(){e("div.il-filter").each((function(){var i=this,n=0,s=1;e(i).find(".il-standard-form").attr("action",window.location.pathname),e(i).find(".il-filter-field-status").each((function(){$hidden_input=this,"0"===e($hidden_input).val()?e(e("div.il-filter .il-popover-container")[n]).hide():e(e("div.il-filter .il-filter-add-list li")[n]).hide(),n++})),e(".il-filter-bar-opener").find("button:first").hide(),e(".il-filter-bar-opener button").click((function(){e(".il-filter-bar-opener button").toggle(),"false"==e(this).attr("aria-expanded")?e(this).attr("aria-expanded","true"):e(this).attr("aria-expanded","false")}));var a=!1;e(i).find(".il-popover-container").each((function(){var i=e(this).find(":input:not(:button)"),n=i.val(),r=e(this).find(".leftaddon").text(),o=t(i,n);""!==o?(e(".il-filter-inputs-active").find("span[id='"+s+"']").html(r+": "+o),a=!0):e(".il-filter-inputs-active").find("span[id='"+s+"']").hide(),s++})),a||e(".il-filter-inputs-active").hide(),e(".input-group .btn.btn-bulky").attr("data-placement","bottom");var o=!0;e(i).find(".il-filter-add-list").find("li").each((function(){"none"!==e(this).css("display")&&"hidden"!==e(this).css("visibility")&&(o=!1)})),o&&e(".btn-bulky").parents(".il-popover-container").hide(),e(".il-filter-field").keydown((function(t){var i=t.which;if(13===i||32===i){e(this).click();var n=r(e(this));0!=n.length&&n[0].focus(),t.preventDefault()}}))}))}));var t=function(t,i){var n="";if(t.is(":checkbox")){var r=[];t.each((function(){e(this).prop("checked")&&r.push(e(this).parent().find("span").text())})),0!=r.length&&(active_checkboxes=r.join(", "),n=active_checkboxes)}else if(t.is("select")&&""!==i){n=t.find("option:selected").text()}else void 0!==i&&""!==i&&(n=i);return n},i=function(t,i,n){e(t.parents(".il-filter").find(".il-filter-field-status").get(i)).val(n)},n=function(e){return e.parents(".il-popover-container").find(":input")},r=function(e){return e.parents(".il-popover-container").find(".il-standard-popover-content").children().children().find("input")},s=function(e){return e.parents(".il-standard-form").find(".btn-bulky").parents(".il-popover-container")};return{onInputUpdate:function(t,i){let n;var r=e(i.triggerer[0]).parents(".il-popover").attr("id");n=r?document.querySelector("span[data-target='"+r+"']"):i.triggerer[0].closest(".input-group").querySelector("span.il-filter-field"),n&&(n.innerText=i.options.string_value)},onRemoveClick:function(t,a){var o=e("#"+a),l=o.parents(".il-popover-container").index();i(o,l,"0"),o.parents(".il-popover-container").hide(),n(o).val("");var d=r(o);d.each((function(){e(this).prop("checked",!1)})),d.parents(".il-popover-container").find(".il-filter-field").html("");var u=o.parents(".input-group").find(".input-group-addon.leftaddon").html(),f=function(t,i){return t.parents(".il-standard-form").find(".btn-link").filter((function(){return e(this).text()===i})).parents("li")}(o,u);f.show();var c=s(o);0!=o.parents(".il-standard-form").find(".il-popover-container:hidden").length&&c.show()},onAddClick:function(t,a){var o=e("#"+a),l=o.text();o.parent().hide();var d=o.parent().index();i(o,d,"1");var u=function(t,i){return t.parents(".il-standard-form").find(".input-group-addon.leftaddon").filter((function(){return e(this).text()===i}))}(o,l);u.parents(".il-popover-container").show(),n(u).focus(),u.parent().find(".il-filter-field").click();var f=r(u);0!=f.length&&f[0].focus();var c=s(o);0===o.parents(".il-filter").find(".il-filter-add-list").find("li:visible").length&&c.hide(),c.find(".il-popover").hide()},onCmd:function(t,i,n){var r=e("#"+i),s=function(e){var t=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],i=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e),n={},r=14;for(;r--;)i[r]&&(n[t[r]]=i[r]);var s=/(?:^|&)([^&=]*)=?([^&]*)/g;return n.query_params={},(n[t[12]]||"").replace(s,(function(e,t,i){t&&(n.query_params[t]=i)})),delete n.source,n}(r.parents("form").attr("data-cmd-"+n));!function(e,t){for(var i in t){var n='<input type="hidden" name="'+i+'" value="'+t[i]+'">';e.parents("form").find(".il-filter-bar").before(n)}}(r,s.query_params),r.parents("form").attr("action",s.path),r.parents("form").submit()},onAjaxCmd:function(t,i,n){var r=e("#"+i),s=r.parents("form").attr("data-cmd-"+n),a=r.parents("form").serialize();e.ajax({type:"GET",url:s+"&"+a})}}}(i.default),il.UI.Input=il.UI.Input||{},il.UI.Input.Container=new class{#o=[];init(e){const t=`#${e}`,i=document.querySelector(t);if(void 0!==this.#o[e])throw new Error(`Container with id '${e}' has already been registered.`);this.#o[e]=new r(i)}get(e){return this.#o[e]}getAll(){return this.#o}first(){return this.#o[Object.keys(this.#o).shift()]}}}($);
