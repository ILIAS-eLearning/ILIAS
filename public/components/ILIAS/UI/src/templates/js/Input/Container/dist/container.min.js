/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=t(e);class n{#e;#t;#i;constructor(e){this.#e=e,this.#t=[],this.#i=[]}addNode(e){this.#t[e.getName()]=e}addField(e){this.#i.push(e)}getName(){return this.#e}getNodes(){return this.#t}getNodeNames(){return Object.keys(this.#t)}getNodeByName(e){return this.#t[e]}getFields(){return this.#i}getValues(){const e=[];return this.#i.forEach((t=>{"checkbox"===t.type||"radio"===t.type?t.checked&&e.push(t.value):e.push(t.value)})),e}}class r{#n;#t;constructor(e){this.#n=e,this.#r()}#r(){this.#n.querySelectorAll("[name]").forEach((e=>{this.#a(this.#t,e.name.split("/"),e)}))}#a(e,t,i){let r=e;const a=t.shift();r||(this.#t=new n(a),r=this.#t),r.getNodeNames().includes(a)||r.addNode(new n(a)),r=r.getNodeByName(a),t.length>0?this.#a(r,t,i):r.addField(i)}node(e){let t=this.#t;return""===e||void 0===e?t.getNodeByName(t.getNodeNames().shift()):(e.split("/").forEach((e=>{t=t.getNodeByName(e)})),t)}getValues(e){const t=this.node(e);return this.#s(t,null)}getValuesFlat(e){const t=this.node(e);return this.#o(t,null,null)}#s(e,t){const i=t||[];i[e.getName()]=e.getValues();return this.#l(e).forEach((t=>this.#s(e.getNodeByName(t),i[e.getName()]))),i}#o(e,t,i){const n=t||[],r=i||[e.getName()];n[r.join("/")]=e.getValues();return this.#l(e).forEach((t=>this.#o(e.getNodeByName(t),n,r.concat([t])))),n}#l(e){let t=e.getNodeNames();if(e.getFields().length>0&&0===e.getValues().length&&(t=[]),e.getFields().length>0&&e.getFields().filter((e=>"radio"===e.type)).length===e.getFields().length){t=[];const i=e.getFields().findIndex((t=>t.value===e.getValues().shift()));e.getNodeNames().length>i&&i>-1&&(t=[e.getNodeNames()[i]])}return t}}il=il||{},il.UI=il.UI||{},il.UI.filter=function(e){e((function(){e("div.il-filter").each((function(){var i=this,n=0,a=1;e(i).find(".il-standard-form").attr("action",window.location.pathname),e(i).find(".il-filter-field-status").each((function(){$hidden_input=this,"0"===e($hidden_input).val()?e(e("div.il-filter .il-popover-container")[n]).hide():e(e("div.il-filter .il-filter-add-list li")[n]).hide(),n++})),e(".il-filter-bar-opener").find("button:first").hide(),e(".il-filter-bar-opener button").click((function(){e(".il-filter-bar-opener button").toggle(),"false"==e(this).attr("aria-expanded")?e(this).attr("aria-expanded","true"):e(this).attr("aria-expanded","false")}));var s=!1;e(i).find(".il-popover-container").each((function(){var i=e(this).find(":input:not(:button)"),n=i.val(),r=e(this).find(".leftaddon").text(),o=t(i,n);""!==o?(e(".il-filter-inputs-active").find("span[id='"+a+"']").html(r+": "+o),s=!0):e(".il-filter-inputs-active").find("span[id='"+a+"']").hide(),a++})),s||e(".il-filter-inputs-active").hide(),e(".input-group .btn.btn-bulky").attr("data-placement","bottom");var o=!0;e(i).find(".il-filter-add-list").find("li").each((function(){"none"!==e(this).css("display")&&"hidden"!==e(this).css("visibility")&&(o=!1)})),o&&e(".btn-bulky").parents(".il-popover-container").hide(),e(".il-filter-field").keydown((function(t){var i=t.which;if(13===i||32===i){e(this).click();var n=r(e(this));0!=n.length&&n[0].focus(),t.preventDefault()}}))}))}));var t=function(t,i){var n="";if(t.is(":checkbox")){var r=[];t.each((function(){e(this).prop("checked")&&r.push(e(this).parent().find("span").text())})),0!=r.length&&(active_checkboxes=r.join(", "),n=active_checkboxes)}else if(t.is("select")&&""!==i){n=t.find("option:selected").text()}else void 0!==i&&""!==i&&(n=i);return n},i=function(t,i,n){e(t.parents(".il-filter").find(".il-filter-field-status").get(i)).val(n)},n=function(e){return e.parents(".il-popover-container").find(":input")},r=function(e){return e.parents(".il-popover-container").find(".il-standard-popover-content").children().children().find("input")},a=function(e){return e.parents(".il-standard-form").find(".btn-bulky").parents(".il-popover-container")};return{onInputUpdate:function(t,i){let n;var r=e(i.triggerer[0]).parents(".il-popover").attr("id");n=r?document.querySelector("span[data-target='"+r+"']"):i.triggerer[0].closest(".input-group").querySelector("span.il-filter-field"),n&&(n.innerText=i.options.string_value)},onRemoveClick:function(t,s){var o=e("#"+s),l=o.parents(".il-popover-container").index();i(o,l,"0"),o.parents(".il-popover-container").hide(),n(o).val("");var d=r(o);d.each((function(){e(this).prop("checked",!1)})),d.parents(".il-popover-container").find(".il-filter-field").html("");var u=o.parents(".input-group").find(".input-group-addon.leftaddon").html(),c=function(t,i){return t.parents(".il-standard-form").find(".btn-link").filter((function(){return e(this).text()===i})).parents("li")}(o,u);c.show();var f=a(o);0!=o.parents(".il-standard-form").find(".il-popover-container:hidden").length&&f.show()},onAddClick:function(t,s){var o=e("#"+s),l=o.text();o.parent().hide();var d=o.parent().index();i(o,d,"1");var u=function(t,i){return t.parents(".il-standard-form").find(".input-group-addon.leftaddon").filter((function(){return e(this).text()===i}))}(o,l);u.parents(".il-popover-container").show(),n(u).focus(),u.parent().find(".il-filter-field").click();var c=r(u);0!=c.length&&c[0].focus();var f=a(o);0===o.parents(".il-filter").find(".il-filter-add-list").find("li:visible").length&&f.hide(),f.find(".il-popover").hide()},onCmd:function(t,i,n){var r=e("#"+i),a=function(e){var t=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],i=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e),n={},r=14;for(;r--;)i[r]&&(n[t[r]]=i[r]);var a=/(?:^|&)([^&=]*)=?([^&]*)/g;return n.query_params={},(n[t[12]]||"").replace(a,(function(e,t,i){t&&(n.query_params[t]=i)})),delete n.source,n}(r.parents("form").attr("data-cmd-"+n));!function(e,t){for(var i in t){var n='<input type="hidden" name="'+i+'" value="'+t[i]+'">';e.parents("form").find(".il-filter-bar").before(n)}}(r,a.query_params),r.parents("form").attr("action",a.path),r.parents("form").submit()},onAjaxCmd:function(t,i,n){var r=e("#"+i),a=r.parents("form").attr("data-cmd-"+n),s=r.parents("form").serialize();e.ajax({type:"GET",url:a+"&"+s})}}}(i.default),il.UI.Input=il.UI.Input||{},il.UI.Input.Container=new class{#d=[];init(e){const t=`#${e}`,i=document.querySelector(t);if(void 0!==this.#d[e])throw new Error(`Container with id '${e}' has already been registered.`);this.#d[e]=new r(i)}get(e){return this.#d[e]}getAll(){return this.#d}first(){return this.#d[Object.keys(this.#d).shift()]}}}($);
