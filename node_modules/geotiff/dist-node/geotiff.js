parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"j27V":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.geoKeys=exports.geoKeyNames=exports.LercAddCompression=exports.LercParameters=exports.ExtraSamplesValues=exports.photometricInterpretations=exports.fieldTypes=exports.fieldTypeNames=exports.arrayFields=exports.fieldTagTypes=exports.fieldTags=exports.fieldTagNames=void 0;const e={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"};exports.fieldTagNames=e;const o={};exports.fieldTags=o;for(const S in e)e.hasOwnProperty(S)&&(o[e[S]]=parseInt(S,10));const t={256:"SHORT",257:"SHORT",258:"SHORT",259:"SHORT",262:"SHORT",273:"LONG",274:"SHORT",277:"SHORT",278:"LONG",279:"LONG",282:"RATIONAL",283:"RATIONAL",284:"SHORT",286:"SHORT",287:"RATIONAL",296:"SHORT",297:"SHORT",305:"ASCII",306:"ASCII",338:"SHORT",339:"SHORT",513:"LONG",514:"LONG",1024:"SHORT",1025:"SHORT",2048:"SHORT",2049:"ASCII",3072:"SHORT",3073:"ASCII",33550:"DOUBLE",33922:"DOUBLE",34665:"LONG",34735:"SHORT",34737:"ASCII",42113:"ASCII"};exports.fieldTagTypes=t;const r=[o.BitsPerSample,o.ExtraSamples,o.SampleFormat,o.StripByteCounts,o.StripOffsets,o.StripRowCounts,o.TileByteCounts,o.TileOffsets,o.SubIFDs];exports.arrayFields=r;const i={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"};exports.fieldTypeNames=i;const s={};exports.fieldTypes=s;for(const S in i)i.hasOwnProperty(S)&&(s[i[S]]=parseInt(S,10));const a={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9};exports.photometricInterpretations=a;const n={Unspecified:0,Assocalpha:1,Unassalpha:2};exports.ExtraSamplesValues=n;const l={Version:0,AddCompression:1};exports.LercParameters=l;const p={None:0,Deflate:1};exports.LercAddCompression=p;const G={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};exports.geoKeyNames=G;const y={};exports.geoKeys=y;for(const S in G)G.hasOwnProperty(S)&&(y[G[S]]=parseInt(S,10));
},{}],"fpBl":[function(require,module,exports) {
"use strict";function t(t,e){const{width:n,height:r}=t,o=new Uint8Array(n*r*3);let h;for(let i=0,l=0;i<t.length;++i,l+=3)h=256-t[i]/e*256,o[l]=h,o[l+1]=h,o[l+2]=h;return o}function e(t,e){const{width:n,height:r}=t,o=new Uint8Array(n*r*3);let h;for(let i=0,l=0;i<t.length;++i,l+=3)h=t[i]/e*256,o[l]=h,o[l+1]=h,o[l+2]=h;return o}function n(t,e){const{width:n,height:r}=t,o=new Uint8Array(n*r*3),h=e.length/3,i=e.length/3*2;for(let l=0,s=0;l<t.length;++l,s+=3){const n=t[l];o[s]=e[n]/65536*256,o[s+1]=e[n+h]/65536*256,o[s+2]=e[n+i]/65536*256}return o}function r(t){const{width:e,height:n}=t,r=new Uint8Array(e*n*3);for(let o=0,h=0;o<t.length;o+=4,h+=3){const e=t[o],n=t[o+1],i=t[o+2],l=t[o+3];r[h]=(255-e)/256*255*((255-l)/256),r[h+1]=(255-n)/256*255*((255-l)/256),r[h+2]=(255-i)/256*255*((255-l)/256)}return r}function o(t){const{width:e,height:n}=t,r=new Uint8ClampedArray(e*n*3);for(let o=0,h=0;o<t.length;o+=3,h+=3){const e=t[o],n=t[o+1],i=t[o+2];r[h]=e+1.402*(i-128),r[h+1]=e-.34414*(n-128)-.71414*(i-128),r[h+2]=e+1.772*(n-128)}return r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromWhiteIsZero=t,exports.fromBlackIsZero=e,exports.fromPalette=n,exports.fromCMYK=r,exports.fromYCbCr=o,exports.fromCIELab=s;const h=.95047,i=1,l=1.08883;function s(t){const{width:e,height:n}=t,r=new Uint8Array(e*n*3);for(let o=0,s=0;o<t.length;o+=3,s+=3){let e,n,a,c=(t[o+0]+16)/116,f=(t[o+1]<<24>>24)/500+c,u=c-(t[o+2]<<24>>24)/200;e=(e=3.2406*(f=h*(f*f*f>.008856?f*f*f:(f-16/116)/7.787))+-1.5372*(c=i*(c*c*c>.008856?c*c*c:(c-16/116)/7.787))+-.4986*(u=l*(u*u*u>.008856?u*u*u:(u-16/116)/7.787)))>.0031308?1.055*e**(1/2.4)-.055:12.92*e,n=(n=-.9689*f+1.8758*c+.0415*u)>.0031308?1.055*n**(1/2.4)-.055:12.92*n,a=(a=.0557*f+-.204*c+1.057*u)>.0031308?1.055*a**(1/2.4)-.055:12.92*a,r[s]=255*Math.max(0,Math.min(1,e)),r[s+1]=255*Math.max(0,Math.min(1,n)),r[s+2]=255*Math.max(0,Math.min(1,a))}return r}
},{}],"FheM":[function(require,module,exports) {
var t=null;function e(){return t||(t=n()),t}function n(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return r(t[0])}return"/"}function r(t){return(""+t).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/,"$1")+"/"}exports.getBundleURL=e,exports.getBaseURL=r;
},{}],"TUK3":[function(require,module,exports) {
var r=require("./bundle-url").getBundleURL;function e(r){Array.isArray(r)||(r=[r]);var e=r[r.length-1];try{return Promise.resolve(require(e))}catch(n){if("MODULE_NOT_FOUND"===n.code)return new s(function(n,i){t(r.slice(0,-1)).then(function(){return require(e)}).then(n,i)});throw n}}function t(r){return Promise.all(r.map(u))}var n={};function i(r,e){n[r]=e}module.exports=exports=e,exports.load=t,exports.register=i;var o={};function u(e){var t;if(Array.isArray(e)&&(t=e[1],e=e[0]),o[e])return o[e];var i=(e.substring(e.lastIndexOf(".")+1,e.length)||e).toLowerCase(),u=n[i];return u?o[e]=u(r()+e).then(function(r){return r&&module.bundle.register(t,r),r}).catch(function(r){throw delete o[e],r}):void 0}function s(r){this.executor=r,this.promise=null}s.prototype.then=function(r,e){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.then(r,e)},s.prototype.catch=function(r){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.catch(r)};
},{"./bundle-url":"FheM"}],"FGCZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addDecoder=r,exports.getDecoder=o;const e=new Map;function r(r,o){Array.isArray(r)||(r=[r]),r.forEach(r=>e.set(r,o))}async function o(r){const o=e.get(r.Compression);if(!o)throw new Error(`Unknown compression method identifier: ${r.Compression}`);return new(await o())(r)}r([void 0,1],()=>require("_bundle_loader")(require.resolve("./raw")).then(e=>e.default)),r(5,()=>require("_bundle_loader")(require.resolve("./lzw")).then(e=>e.default)),r(6,()=>{throw new Error("old style JPEG compression is not supported.")}),r(7,()=>require("_bundle_loader")(require.resolve("./jpeg")).then(e=>e.default)),r([8,32946],()=>require("_bundle_loader")(require.resolve("./deflate")).then(e=>e.default)),r(32773,()=>require("_bundle_loader")(require.resolve("./packbits")).then(e=>e.default)),r(34887,()=>require("_bundle_loader")(require.resolve("./lerc")).then(e=>e.default));
},{"_bundle_loader":"TUK3","./raw":[["raw.50a70f7d.js","V9bQ"],"raw.50a70f7d.js.map","V9bQ"],"./lzw":[["lzw.1fba8d7d.js","tcId"],"lzw.1fba8d7d.js.map","tcId"],"./jpeg":[["jpeg.62e69c63.js","J7kk"],"jpeg.62e69c63.js.map","J7kk"],"./deflate":[["deflate.c1d0255b.js","JAiC"],"deflate.c1d0255b.js.map","JAiC"],"./packbits":[["packbits.dfd39c1a.js","OcPz"],"packbits.dfd39c1a.js.map","OcPz"],"./lerc":[["lerc.ecdb7f1d.js","YN9V"],"lerc.ecdb7f1d.js.map","YN9V"]}],"OQju":[function(require,module,exports) {
"use strict";function e(e,t,r,n=1){return new(Object.getPrototypeOf(e).constructor)(t*r*n)}function t(t,r,n,o,a){const s=r/o,c=n/a;return t.map(t=>{const l=e(t,o,a);for(let e=0;e<a;++e){const a=Math.min(Math.round(c*e),n-1);for(let n=0;n<o;++n){const c=Math.min(Math.round(s*n),r-1),i=t[a*r+c];l[e*o+n]=i}}return l})}function r(e,t,r){return(1-r)*e+r*t}function n(t,n,o,a,s){const c=n/a,l=o/s;return t.map(t=>{const i=e(t,a,s);for(let e=0;e<s;++e){const s=l*e,u=Math.floor(s),f=Math.min(Math.ceil(s),o-1);for(let o=0;o<a;++o){const l=c*o,h=l%1,p=Math.floor(l),M=Math.min(Math.ceil(l),n-1),m=t[u*n+p],d=t[u*n+M],w=t[f*n+p],x=t[f*n+M],b=r(r(m,d,h),r(w,x,h),s%1);i[e*a+o]=b}}return i})}function o(e,r,o,a,s,c="nearest"){switch(c.toLowerCase()){case"nearest":return t(e,r,o,a,s);case"bilinear":case"linear":return n(e,r,o,a,s);default:throw new Error(`Unsupported resampling method: '${c}'`)}}function a(t,r,n,o,a,s){const c=r/o,l=n/a,i=e(t,o,a,s);for(let e=0;e<a;++e){const a=Math.min(Math.round(l*e),n-1);for(let n=0;n<o;++n){const l=Math.min(Math.round(c*n),r-1);for(let c=0;c<s;++c){const u=t[a*r*s+l*s+c];i[e*o*s+n*s+c]=u}}}return i}function s(t,n,o,a,s,c){const l=n/a,i=o/s,u=e(t,a,s,c);for(let e=0;e<s;++e){const s=i*e,f=Math.floor(s),h=Math.min(Math.ceil(s),o-1);for(let o=0;o<a;++o){const i=l*o,p=i%1,M=Math.floor(i),m=Math.min(Math.ceil(i),n-1);for(let l=0;l<c;++l){const i=t[f*n*c+M*c+l],d=t[f*n*c+m*c+l],w=t[h*n*c+M*c+l],x=t[h*n*c+m*c+l],b=r(r(i,d,p),r(w,x,p),s%1);u[e*a*c+o*c+l]=b}}}return u}function c(e,t,r,n,o,c,l="nearest"){switch(l.toLowerCase()){case"nearest":return a(e,t,r,n,o,c);case"bilinear":case"linear":return s(e,t,r,n,o,c);default:throw new Error(`Unsupported resampling method: '${l}'`)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.resampleNearest=t,exports.resampleBilinear=n,exports.resample=o,exports.resampleNearestInterleaved=a,exports.resampleBilinearInterleaved=s,exports.resampleInterleaved=c;
},{}],"eOWo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("@petamoriken/float16"),e=n(require("xml-utils/get-attribute")),i=n(require("xml-utils/find-tags-by-name")),r=require("./globals"),o=require("./rgb"),a=require("./compression"),s=require("./resample");function n(t){return t&&t.__esModule?t:{default:t}}function l(t,e,i){let r=0;for(let o=e;o<i;++o)r+=t[o];return r}function h(t,e,i){switch(t){case 1:if(e<=8)return new Uint8Array(i);if(e<=16)return new Uint16Array(i);if(e<=32)return new Uint32Array(i);break;case 2:if(8===e)return new Int8Array(i);if(16===e)return new Int16Array(i);if(32===e)return new Int32Array(i);break;case 3:switch(e){case 16:case 32:return new Float32Array(i);case 64:return new Float64Array(i)}}throw Error("Unsupported data format/bitsPerSample")}function c(t,e){return(1!==t&&2!==t||!(e<=32)||e%8!=0)&&(3!==t||16!==e&&32!==e&&64!==e)}function g(t,e,i,r,o,a,s){const n=new DataView(t),l=2===i?1:r,c=h(e,o,2===i?s*a:s*a*r),g=parseInt("1".repeat(o),2);if(1===e){let t,e=a*(t=1===i?r*o:o);0!=(7&e)&&(e=e+7&-8);for(let i=0;i<s;++i){const t=i*e;for(let e=0;e<a;++e){const r=t+e*l*o;for(let t=0;t<l;++t){const s=r+t*o,h=(i*a+e)*l+t,f=Math.floor(s/8),p=s%8;if(p+o<=8)c[h]=n.getUint8(f)>>8-o-p&g;else if(p+o<=16)c[h]=n.getUint16(f)>>16-o-p&g;else if(p+o<=24){const t=n.getUint16(f)<<8|n.getUint8(f+2);c[h]=t>>24-o-p&g}else c[h]=n.getUint32(f)>>32-o-p&g}}}}return c.buffer}class f{constructor(t,e,i,r,o,a){this.fileDirectory=t,this.geoKeys=e,this.dataView=i,this.littleEndian=r,this.tiles=o?{}:null,this.isTiled=!t.StripOffsets;const s=t.PlanarConfiguration;if(this.planarConfiguration=void 0===s?1:s,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return void 0!==this.fileDirectory.SamplesPerPixel?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:void 0!==this.fileDirectory.RowsPerStrip?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let e=0;e<this.fileDirectory.BitsPerSample.length;++e)t+=this.getSampleByteSize(e);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(e){const i=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(i){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(e,i){return(0,t.getFloat16)(this,e,i)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,e){return h(this.getSampleFormat(t),this.getBitsPerSample(t),e)}async getTileOrStrip(t,e,i,r,o){const a=Math.ceil(this.getWidth()/this.getTileWidth()),s=Math.ceil(this.getHeight()/this.getTileHeight());let n;const{tiles:l}=this;let h,f;1===this.planarConfiguration?n=e*a+t:2===this.planarConfiguration&&(n=i*a*s+e*a+t),this.isTiled?(h=this.fileDirectory.TileOffsets[n],f=this.fileDirectory.TileByteCounts[n]):(h=this.fileDirectory.StripOffsets[n],f=this.fileDirectory.StripByteCounts[n]);const p=(await this.source.fetch([{offset:h,length:f}],o))[0];let u;return null!==l&&l[n]?u=l[n]:(u=(async()=>{let t=await r.decode(this.fileDirectory,p);const i=this.getSampleFormat(),o=this.getBitsPerSample();return c(i,o)&&(t=g(t,i,this.planarConfiguration,this.getSamplesPerPixel(),o,this.getTileWidth(),this.getBlockHeight(e))),t})(),null!==l&&(l[n]=u)),{x:t,y:e,sample:i,data:await u}}async _readRaster(t,e,i,r,o,a,n,h,c){const g=this.getTileWidth(),f=this.getTileHeight(),p=this.getWidth(),u=this.getHeight(),m=Math.max(Math.floor(t[0]/g),0),d=Math.min(Math.ceil(t[2]/g),Math.ceil(p/g)),y=Math.max(Math.floor(t[1]/f),0),w=Math.min(Math.ceil(t[3]/f),Math.ceil(u/f)),D=t[2]-t[0];let M=this.getBytesPerPixel();const S=[],T=[];for(let s=0;s<e.length;++s)1===this.planarConfiguration?S.push(l(this.fileDirectory.BitsPerSample,0,e[s])/8):S.push(0),T.push(this.getReaderForSample(e[s]));const I=[],{littleEndian:P}=this;for(let s=y;s<w;++s)for(let a=m;a<d;++a)for(let n=0;n<e.length;++n){const l=n,h=e[n];2===this.planarConfiguration&&(M=this.getSampleByteSize(n));const m=this.getTileOrStrip(a,s,h,o,c);I.push(m),m.then(o=>{const a=o.data,s=new DataView(a),n=this.getBlockHeight(o.y),h=o.y*f,c=o.x*g,m=h+n,d=(o.x+1)*g,y=T[l],w=Math.min(n,n-(m-t[3]),u-h),I=Math.min(g,g-(d-t[2]),p-c);for(let f=Math.max(0,t[1]-h);f<w;++f)for(let o=Math.max(0,t[0]-c);o<I;++o){const a=(f*g+o)*M,n=y.call(s,a+S[l],P);let p;r?(p=(f+h-t[1])*D*e.length+(o+c-t[0])*e.length+l,i[p]=n):(p=(f+h-t[1])*D+o+c-t[0],i[l][p]=n)}})}if(await Promise.all(I),a&&t[2]-t[0]!==a||n&&t[3]-t[1]!==n){let o;return(o=r?(0,s.resampleInterleaved)(i,t[2]-t[0],t[3]-t[1],a,n,e.length,h):(0,s.resample)(i,t[2]-t[0],t[3]-t[1],a,n,h)).width=a,o.height=n,o}return i.width=a||t[2]-t[0],i.height=n||t[3]-t[1],i}async readRasters({window:t,samples:e=[],interleave:i,pool:r=null,width:o,height:s,resampleMethod:n,fillValue:l,signal:c}={}){const g=t||[0,0,this.getWidth(),this.getHeight()];if(g[0]>g[2]||g[1]>g[3])throw new Error("Invalid subsets");const f=(g[2]-g[0])*(g[3]-g[1]),p=this.getSamplesPerPixel();if(e&&e.length){for(let a=0;a<e.length;++a)if(e[a]>=p)return Promise.reject(new RangeError(`Invalid sample index '${e[a]}'.`))}else for(let a=0;a<p;++a)e.push(a);let u;if(i){u=h(this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Math.max.apply(null,this.fileDirectory.BitsPerSample),f*e.length),l&&u.fill(l)}else{u=[];for(let t=0;t<e.length;++t){const i=this.getArrayForSample(e[t],f);Array.isArray(l)&&t<l.length?i.fill(l[t]):l&&!Array.isArray(l)&&i.fill(l),u.push(i)}}const m=r||await(0,a.getDecoder)(this.fileDirectory);return await this._readRaster(g,e,u,i,m,o,s,n,c)}async readRGB({window:t,interleave:e=!0,pool:i=null,width:a,height:s,resampleMethod:n,enableAlpha:l=!1,signal:h}={}){const c=t||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const g=this.fileDirectory.PhotometricInterpretation;if(g===r.photometricInterpretations.RGB){let o=[0,1,2];if(this.fileDirectory.ExtraSamples!==r.ExtraSamplesValues.Unspecified&&l){o=[];for(let t=0;t<this.fileDirectory.BitsPerSample.length;t+=1)o.push(t)}return this.readRasters({window:t,interleave:e,samples:o,pool:i,width:a,height:s,resampleMethod:n,signal:h})}let f;switch(g){case r.photometricInterpretations.WhiteIsZero:case r.photometricInterpretations.BlackIsZero:case r.photometricInterpretations.Palette:f=[0];break;case r.photometricInterpretations.CMYK:f=[0,1,2,3];break;case r.photometricInterpretations.YCbCr:case r.photometricInterpretations.CIELab:f=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const p={window:c,interleave:!0,samples:f,pool:i,width:a,height:s,resampleMethod:n,signal:h},{fileDirectory:u}=this,m=await this.readRasters(p),d=2**this.fileDirectory.BitsPerSample[0];let y;switch(g){case r.photometricInterpretations.WhiteIsZero:y=(0,o.fromWhiteIsZero)(m,d);break;case r.photometricInterpretations.BlackIsZero:y=(0,o.fromBlackIsZero)(m,d);break;case r.photometricInterpretations.Palette:y=(0,o.fromPalette)(m,u.ColorMap);break;case r.photometricInterpretations.CMYK:y=(0,o.fromCMYK)(m);break;case r.photometricInterpretations.YCbCr:y=(0,o.fromYCbCr)(m);break;case r.photometricInterpretations.CIELab:y=(0,o.fromCIELab)(m);break;default:throw new Error("Unsupported photometric interpretation.")}if(!e){const t=new Uint8Array(y.length/3),e=new Uint8Array(y.length/3),i=new Uint8Array(y.length/3);for(let r=0,o=0;r<y.length;r+=3,++o)t[o]=y[r],e[o]=y[r+1],i[o]=y[r+2];y=[t,e,i]}return y.width=m.width,y.height=m.height,y}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let e=0;e<this.fileDirectory.ModelTiepoint.length;e+=6)t.push({i:this.fileDirectory.ModelTiepoint[e],j:this.fileDirectory.ModelTiepoint[e+1],k:this.fileDirectory.ModelTiepoint[e+2],x:this.fileDirectory.ModelTiepoint[e+3],y:this.fileDirectory.ModelTiepoint[e+4],z:this.fileDirectory.ModelTiepoint[e+5]});return t}getGDALMetadata(t=null){const r={};if(!this.fileDirectory.GDAL_METADATA)return null;const o=this.fileDirectory.GDAL_METADATA;let a=(0,i.default)(o,"Item");null!==t&&(a=a.filter(i=>Number((0,e.default)(i,"sample"))===t));for(let i=0;i<a.length;++i){const t=a[i];r[(0,e.default)(t,"name")]=t.inner}return r}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,e=this.fileDirectory.ModelTransformation;if(t&&6===t.length)return[t[3],t[4],t[5]];if(e)return[e[3],e[7],e[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const e=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(e)return[e[0],-e[1],e[2]];if(i)return[i[0],i[5],i[10]];if(t){const[e,i,r]=t.getResolution();return[e*t.getWidth()/this.getWidth(),i*t.getHeight()/this.getHeight(),r*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return 1===this.geoKeys.GTRasterTypeGeoKey}getBoundingBox(){const t=this.getOrigin(),e=this.getResolution(),i=t[0],r=t[1],o=i+e[0]*this.getWidth(),a=r+e[1]*this.getHeight();return[Math.min(i,o),Math.min(r,a),Math.max(i,o),Math.max(r,a)]}}var p=f;exports.default=p;
},{"./globals":"j27V","./rgb":"fpBl","./compression":"FGCZ","./resample":"OQju"}],"dqpX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("@petamoriken/float16");class e{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,e){const i=this.getUint32(t,e),r=this.getUint32(t+4,e);let s;if(e){if(s=i+2**32*r,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. `+"Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues");return s}if(s=2**32*i+r,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. `+"Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues");return s}getInt64(t,e){let i=0;const r=(128&this._dataView.getUint8(t+(e?7:0)))>0;let s=!0;for(let a=0;a<8;a++){let n=this._dataView.getUint8(t+(e?a:7-a));r&&(s?0!==n&&(n=255&~(n-1),s=!1):n=255&~n),i+=n*256**a}return r&&(i=-i),i}getUint8(t,e){return this._dataView.getUint8(t,e)}getInt8(t,e){return this._dataView.getInt8(t,e)}getUint16(t,e){return this._dataView.getUint16(t,e)}getInt16(t,e){return this._dataView.getInt16(t,e)}getUint32(t,e){return this._dataView.getUint32(t,e)}getInt32(t,e){return this._dataView.getInt32(t,e)}getFloat16(e,i){return(0,t.getFloat16)(this._dataView,e,i)}getFloat32(t,e){return this._dataView.getFloat32(t,e)}getFloat64(t,e){return this._dataView.getFloat64(t,e)}}exports.default=e;
},{}],"dGLV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(t,e,i,s){this._dataView=new DataView(t),this._sliceOffset=e,this._littleEndian=i,this._bigTiff=s}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,e){return this.sliceOffset<=t&&this.sliceTop>=t+e}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const e=this.readUint32(t),i=this.readUint32(t+4);let s;if(this._littleEndian){if(s=e+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. `+"Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues");return s}if(s=2**32*e+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. `+"Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues");return s}readInt64(t){let e=0;const i=(128&this._dataView.getUint8(t+(this._littleEndian?7:0)))>0;let s=!0;for(let r=0;r<8;r++){let n=this._dataView.getUint8(t+(this._littleEndian?r:7-r));i&&(s?0!==n&&(n=255&~(n-1),s=!1):n=255&~n),e+=n*256**r}return i&&(e=-e),e}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}exports.default=t;
},{}],"dHPO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("threads");const r="undefined"!=typeof navigator?navigator.hardwareConcurrency:null;class t{constructor(t=r,o=new e.Worker("/decoder.worker.3778dc6e.js")){this.pool=(0,e.Pool)(()=>(0,e.spawn)(o),t)}async decode(r,t){return new Promise((o,a)=>{this.pool.queue(async s=>{try{const c=await s(r,(0,e.Transfer)(t));o(c)}catch(n){a(n)}})})}destroy(){this.pool.terminate(!0)}}var o=t;exports.default=o;
},{"./decoder.worker.js":[["decoder.worker.3778dc6e.js","LHx9"],"decoder.worker.3778dc6e.js.map","LHx9"]}],"ZJpj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseContentType=r,exports.parseContentRange=s,exports.parseByteRanges=o;const t="\r\n\r\n";function e(t){if(void 0!==Object.fromEntries)return Object.fromEntries(t);const e={};for(const[n,r]of t)e[n.toLowerCase()]=r;return e}function n(t){return e(t.split("\r\n").map(t=>{const e=t.split(":").map(t=>t.trim());return e[0]=e[0].toLowerCase(),e}))}function r(t){const[n,...r]=t.split(";").map(t=>t.trim());return{type:n,params:e(r.map(t=>t.split("=")))}}function s(t){let e,n,r;return t&&([,e,n,r]=t.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),n=parseInt(n,10),r=parseInt(r,10)),{start:e,end:n,total:r}}function o(e,r){let o=null;const a=new TextDecoder("ascii"),i=[],l=`--${r}`,c=`${l}--`;for(let t=0;t<10;++t){a.decode(new Uint8Array(e,t,l.length))===l&&(o=t)}if(null===o)throw new Error("Could not find initial boundary");for(;o<e.byteLength;){const r=a.decode(new Uint8Array(e,o,Math.min(l.length+1024,e.byteLength-o)));if(0===r.length||r.startsWith(c))break;if(!r.startsWith(l))throw new Error("Part does not start with boundary");const p=r.substr(l.length+2);if(0===p.length)break;const u=p.indexOf(t),f=n(p.substr(0,u)),{start:d,end:h,total:g}=s(f["content-range"]),b=o+l.length+u+t.length,m=parseInt(h,10)+1-parseInt(d,10);i.push({headers:f,data:e.slice(b,b+m),offset:d,length:m,fileSize:g}),o=b+m+4}return i}
},{}],"LzCD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseSource=void 0;class e{async fetch(e,s){return Promise.all(e.map(e=>this.fetchSlice(e,s)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}exports.BaseSource=e;
},{}],"FOZT":[function(require,module,exports) {
"use strict";function r(r,t){for(const e in t)t.hasOwnProperty(e)&&(r[e]=t[e])}function t(r,t){const e=[],n=r.length;for(let o=0;o<n;o+=t){const n=[];for(let e=o;e<o+t;e++)n.push(r[e]);e.push(n)}return e}function e(r,t){if(r.length<t.length)return!1;return r.substr(r.length-t.length)===t}function n(r,t){const{length:e}=r;for(let n=0;n<e;n++)t(r[n],n)}function o(r){const t={};for(const e in r)if(r.hasOwnProperty(e)){t[r[e]]=e}return t}function s(r){const t=[];for(let e=0;e<r;e++)t.push(e);return t}function u(r,t){const e=[];for(let n=0;n<r;n++)e.push(t(n));return e}function c(r){const t=[],{length:e}=r;for(let n=0;n<e;n++)t.push(r[n]);return t}function a(r){return r.length?c(r).map(a):r}function i(r){if(!r)return null;if("string"!=typeof r)throw new Error("invalid argument");const t=r=>Number.parseInt(r,10);let e=r.match(/^(\w*) /);const n=e&&e[1];return(e=r.match(/(\d+)-(\d+)\/(\d+|\*)/))?{unit:n,first:t(e[1]),last:t(e[2]),length:"*"===e[3]?null:t(e[3])}:(e=r.match(/(\d+|\*)/))?{unit:n,first:null,last:null,length:"*"===e[1]?null:t(e[1])}:null}async function l(r){return new Promise(t=>setTimeout(t,r))}function p(r,t){const e=Array.isArray(r)?r:Array.from(r),n=Array.isArray(t)?t:Array.from(t);return e.map((r,t)=>[r,n[t]])}Object.defineProperty(exports,"__esModule",{value:!0}),exports.assign=r,exports.chunk=t,exports.endsWith=e,exports.forEach=n,exports.invert=o,exports.range=s,exports.times=u,exports.toArray=c,exports.toArrayRecursively=a,exports.parseContentRange=i,exports.wait=l,exports.zip=p,exports.AggregateError=exports.CustomAggregateError=exports.AbortError=void 0;class f extends Error{constructor(r){super(r),Error.captureStackTrace&&Error.captureStackTrace(this,f),this.name="AbortError"}}exports.AbortError=f;class g extends Error{constructor(r,t){super(t),this.errors=r,this.message=t,this.name="AggregateError"}}exports.CustomAggregateError=g;const h=g;exports.AggregateError=h;
},{}],"xD7g":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BlockedSource=void 0;var t=o(require("lru-cache")),e=require("./basesource"),s=require("../utils");function o(t){return t&&t.__esModule?t:{default:t}}class r{constructor(t,e,s=null){this.offset=t,this.length=e,this.data=s}get top(){return this.offset+this.length}}class c{constructor(t,e,s){this.offset=t,this.length=e,this.blockIds=s}}class i extends e.BaseSource{constructor(e,{blockSize:s=65536,cacheSize:o=100}={}){super(),this.source=e,this.blockSize=s,this.blockCache=new t.default({max:o}),this.blockRequests=new Map,this.blockIdsToFetch=new Set}get fileSize(){return this.source.fileSize}async fetch(t,e){const o=new Map,r=new Map,c=new Set;for(const{offset:s,length:n}of t){let t=s+n;const{fileSize:e}=this;null!==e&&(t=Math.min(t,e));for(let i=Math.floor(s/this.blockSize)*this.blockSize;i<t;i+=this.blockSize){const t=Math.floor(i/this.blockSize);this.blockCache.has(t)?o.set(t,this.blockCache.get(t)):this.blockRequests.has(t)?r.set(t,this.blockRequests.get(t)):this.blockIdsToFetch.has(t)?c.add(t):(this.blockIdsToFetch.add(t),c.add(t))}}await(0,s.wait)(),this.fetchBlocks(e);for(const s of c){const t=this.blockRequests.get(s),e=this.blockCache.get(s);if(t)r.set(s,t);else{if(!e)throw new Error(`Block ${s} is not in the block requests`);o.set(s,e)}}let i=await Promise.allSettled(Array.from(r.values()));if(i.some(t=>"rejected"===t.status)){const t=new Set;for(const[o,c]of(0,s.zip)(r.keys(),i)){const{rejected:s,reason:r}=c;s&&"AbortError"===r.name&&r.signal!==e&&(this.blockIdsToFetch.add(o),t.add(o))}if(this.blockIdsToFetch.length>0){this.fetchBlocks(e);for(const e of t){const t=this.blockRequests.get(e);if(!t)throw new Error(`Block ${e} is not in the block requests`);r.set(e,t)}i=await Promise.allSettled(Array.from(r.values()))}}if(i.some(t=>"rejected"===t.status)){if(e&&e.aborted)throw new s.AbortError("Request was aborted");throw new s.AggregateError(i.filter(t=>"rejected"===t.status).map(t=>t.reason),"Request failed")}const l=i.map(t=>t.value),h=new Map((0,s.zip)(Array.from(r.keys()),l));for(const[s,n]of o)h.set(s,n);return this.readSliceData(t,h)}fetchBlocks(t){if(this.blockIdsToFetch.size>0){const e=this.groupBlocks(this.blockIdsToFetch),s=this.source.fetch(e,t);for(let o=0;o<e.length;++o){const c=e[o];for(const e of c.blockIds){const c=(async()=>{try{const i=(await s)[o],l=e*this.blockSize,h=l-i.offset,n=Math.min(h+this.blockSize,i.data.byteLength),a=i.data.slice(h,n),f=new r(l,a.byteLength,a);return this.blockCache.set(e,f),f}catch(c){throw"AbortError"===c.name&&(c.signal=t),c}finally{this.blockRequests.delete(e)}})();this.blockRequests.set(e,c)}}this.blockIdsToFetch.clear()}}groupBlocks(t){const e=Array.from(t).sort((t,e)=>t-e);if(0===e.length)return[];let s=[],o=null;const r=[];for(const i of e)null===o||o+1===i?(s.push(i),o=i):(r.push(new c(s[0]*this.blockSize,s.length*this.blockSize,s)),s=[i],o=i);return r.push(new c(s[0]*this.blockSize,s.length*this.blockSize,s)),r}readSliceData(t,e){return t.map(t=>{const s=t.offset+t.length,o=Math.floor(t.offset/this.blockSize),r=Math.floor((t.offset+t.length)/this.blockSize),c=new ArrayBuffer(t.length),i=new Uint8Array(c);for(let l=o;l<=r;++l){const o=e.get(l),r=o.offset-t.offset,c=o.top-s;let h,n=0,a=0;r<0?n=-r:r>0&&(a=r),h=c<0?o.length-n:s-o.offset-n;const f=new Uint8Array(o.data,n,h);i.set(f,a)}return c})}}exports.BlockedSource=i;
},{"./basesource":"LzCD","../utils":"FOZT"}],"uL1U":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseClient=exports.BaseResponse=void 0;class e{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}exports.BaseResponse=e;class t{constructor(e){this.url=e}async request({headers:e,credentials:t,signal:s}={}){throw new Error("request is not implemented")}}exports.BaseClient=t;
},{}],"Un5s":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FetchClient=void 0;var e=require("./base");class s extends e.BaseResponse{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class t extends e.BaseClient{constructor(e,s){super(e),this.credentials=s}async request({headers:e,credentials:t,signal:r}={}){const a=await fetch(this.url,{headers:e,credentials:t,signal:r});return new s(a)}}exports.FetchClient=t;
},{"./base":"uL1U"}],"hvgd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.XHRClient=void 0;var e=require("./base"),t=require("../../utils");class r extends e.BaseResponse{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class s extends e.BaseClient{constructRequest(e,s){return new Promise((n,a)=>{const o=new XMLHttpRequest;o.open("GET",this.url),o.responseType="arraybuffer";for(const[t,r]of Object.entries(e))o.setRequestHeader(t,r);o.onload=(()=>{const e=o.response;n(new r(o,e))}),o.onerror=a,o.onabort=(()=>a(new t.AbortError("Request aborted"))),o.send(),s&&(s.aborted&&o.abort(),s.addEventListener("abort",()=>o.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}exports.XHRClient=s;
},{"./base":"uL1U","../../utils":"FOZT"}],"SHlS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HttpClient=void 0;var e=a(require("http")),t=a(require("https")),r=a(require("url")),s=require("./base"),o=require("../../utils");function a(e){return e&&e.__esModule?e:{default:e}}class n extends s.BaseResponse{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class u extends s.BaseClient{constructor(s){super(s),this.parsedUrl=r.default.parse(this.url),this.httpApi="http:"===this.parsedUrl.protocol?e.default:t.default}constructRequest(e,t){return new Promise((r,s)=>{const a=this.httpApi.get({...this.parsedUrl,headers:e},e=>{const t=new Promise(t=>{const r=[];e.on("data",e=>{r.push(e)}),e.on("end",()=>{const e=Buffer.concat(r).buffer;t(e)}),e.on("error",s)});r(new n(e,t))});a.on("error",s),t&&(t.aborted&&a.destroy(new o.AbortError("Request aborted")),t.addEventListener("abort",()=>a.destroy(new o.AbortError("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}exports.HttpClient=u;
},{"./base":"uL1U","../../utils":"FOZT"}],"itmA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeFetchSource=o,exports.makeXHRSource=c,exports.makeHttpSource=h,exports.makeRemoteSource=u;var e=require("./httputils"),t=require("./basesource"),n=require("./blockedsource"),r=require("./client/fetch"),a=require("./client/xhr"),i=require("./client/http");class s extends t.BaseSource{constructor(e,t,n,r){super(),this.client=e,this.headers=t,this.maxRanges=n,this.allowFullFile=r,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length,Promise.all(e.map(e=>this.fetchSlice(e,t))))}async fetchSlices(t,n){const r=await this.client.request({headers:{...this.headers,Range:`bytes=${t.map(({offset:e,length:t})=>`${e}-${e+t}`).join(",")}`},signal:n});if(r.ok){if(206===r.status){const{type:a,params:i}=(0,e.parseContentType)(r.getHeader("content-type"));if("multipart/byteranges"===a){const t=(0,e.parseByteRanges)(await r.getData(),i.boundary);return this._fileSize=t[0].fileSize||null,t}const s=await r.getData(),{start:l,end:o,total:c}=(0,e.parseContentRange)(r.getHeader("content-range"));this._fileSize=c||null;const h=[{data:s,offset:l,length:o-l}];if(t.length>1){const e=await Promise.all(t.slice(1).map(e=>this.fetchSlice(e,n)));return h.concat(e)}return h}{if(!this.allowFullFile)throw new Error("Server responded with full file");const e=await r.getData();return this._fileSize=e.byteLength,[{data:e,offset:0,length:e.byteLength}]}}throw new Error("Error fetching data.")}async fetchSlice(t,n){const{offset:r,length:a}=t,i=await this.client.request({headers:{...this.headers,Range:`bytes=${r}-${r+a}`},signal:n});if(i.ok){if(206===i.status){const t=await i.getData(),{total:n}=(0,e.parseContentRange)(i.getHeader("content-range"));return this._fileSize=n||null,{data:t,offset:r,length:a}}{if(!this.allowFullFile)throw new Error("Server responded with full file");const e=await i.getData();return this._fileSize=e.byteLength,{data:e,offset:0,length:e.byteLength}}}throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function l(e,{blockSize:t,cacheSize:r}){return null===t?e:new n.BlockedSource(e,t,r)}function o(e,{headers:t={},credentials:n,maxRanges:a=0,allowFullFile:i=!1,...o}={}){const c=new r.FetchClient(e,n);return l(new s(c,t,a,i),o)}function c(e,{headers:t={},maxRanges:n=0,allowFullFile:r=!1,...i}={}){const o=new a.XHRClient(e);return l(new s(o,t,n,r),i)}function h(e,{headers:t={},maxRanges:n=0,allowFullFile:r=!1,...a}={}){const o=new i.HttpClient(e);return l(new s(o,t,n,r),a)}function u(e,{forceXHR:t=!1,...n}={}){return"function"!=typeof fetch||t?"undefined"!=typeof XMLHttpRequest?c(e,n):h(e,n):o(e,n)}
},{"./httputils":"ZJpj","./basesource":"LzCD","./blockedsource":"xD7g","./client/fetch":"Un5s","./client/xhr":"hvgd","./client/http":"SHlS"}],"wM9h":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeBufferSource=s;var e=require("./basesource"),r=require("../utils");class t extends e.BaseSource{constructor(e){super(),this.arrayBuffer=e}fetchSlice(e,t){if(t&&t.aborted)throw new r.AbortError("Request aborted");return this.arrayBuffer.slice(e.offset,e.offset+e.length)}}function s(e){return new t(e)}
},{"./basesource":"LzCD","../utils":"FOZT"}],"GiEG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeFileReaderSource=t;var e=require("./basesource");class r extends e.BaseSource{constructor(e){super(),this.file=e}async fetchSlice(e,r){return new Promise((t,s)=>{const o=this.file.slice(e.offset,e.offset+e.length),n=new FileReader;n.onload=(e=>t(e.target.result)),n.onerror=s,n.onabort=s,n.readAsArrayBuffer(o),r&&r.addEventListener("abort",()=>n.abort())})}}function t(e){return new r(e)}
},{"./basesource":"LzCD"}],"G7Cz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeFileSource=a;var e=r(require("fs")),t=require("./basesource");function r(e){return e&&e.__esModule?e:{default:e}}function n(t){return new Promise((r,n)=>{e.default.close(t,e=>{e?n(e):r()})})}function s(t,r,n){return new Promise((s,u)=>{e.default.open(t,r,n,(e,t)=>{e?u(e):s(t)})})}function u(...t){return new Promise((r,n)=>{e.default.read(...t,(e,t,s)=>{e?n(e):r({bytesRead:t,buffer:s})})})}class o extends t.BaseSource{constructor(e){super(),this.path=e,this.openRequest=s(e,"r")}async fetchSlice(e){const t=await this.openRequest,{buffer:r}=await u(t,Buffer.alloc(e.length),0,e.length,e.offset);return r.buffer}async close(){const e=await this.openRequest;await n(e)}}function a(e){return new o(e)}
},{"./basesource":"LzCD"}],"BGyE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.writeGeotiff=y;var e=require("./globals"),t=require("./utils");const r=(0,t.invert)(e.fieldTagNames),o=(0,t.invert)(e.geoKeyNames),i={};(0,t.assign)(i,r),(0,t.assign)(i,o);const n=(0,t.invert)(e.fieldTypeNames),s=1e3,a={nextZero:(e,t)=>{let r=t;for(;0!==e[r];)r++;return r},readUshort:(e,t)=>e[t]<<8|e[t+1],readShort:(e,t)=>{const r=a.ui8;return r[0]=e[t+1],r[1]=e[t+0],a.i16[0]},readInt:(e,t)=>{const r=a.ui8;return r[0]=e[t+3],r[1]=e[t+2],r[2]=e[t+1],r[3]=e[t+0],a.i32[0]},readUint:(e,t)=>{const r=a.ui8;return r[0]=e[t+3],r[1]=e[t+2],r[2]=e[t+1],r[3]=e[t+0],a.ui32[0]},readASCII:(e,t,r)=>r.map(r=>String.fromCharCode(e[t+r])).join(""),readFloat:(e,r)=>{const o=a.ui8;return(0,t.times)(4,t=>{o[t]=e[r+3-t]}),a.fl32[0]},readDouble:(e,r)=>{const o=a.ui8;return(0,t.times)(8,t=>{o[t]=e[r+7-t]}),a.fl64[0]},writeUshort:(e,t,r)=>{e[t]=r>>8&255,e[t+1]=255&r},writeUint:(e,t,r)=>{e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=r>>0&255},writeASCII:(e,r,o)=>{(0,t.times)(o.length,t=>{e[r+t]=o.charCodeAt(t)})},ui8:new Uint8Array(8)};a.fl64=new Float64Array(a.ui8.buffer),a.writeDouble=((e,r,o)=>{a.fl64[0]=o,(0,t.times)(8,t=>{e[r+t]=a.ui8[7-t]})});const l=(r,o,i,s)=>{let a=i;const l=Object.keys(s).filter(e=>null!=e&&"undefined"!==e);r.writeUshort(o,a,l.length);let c=(a+=2)+12*l.length+4;for(const f of l){let i=null;"number"==typeof f?i=f:"string"==typeof f&&(i=parseInt(f,10));const l=e.fieldTagTypes[i],h=n[l];if(null==l||void 0===l||void 0===l)throw new Error(`unknown type of tag: ${i}`);let u=s[f];if(void 0===u)throw new Error(`failed to get value for key ${f}`);"ASCII"===l&&"string"==typeof u&&!1===(0,t.endsWith)(u,"\0")&&(u+="\0");const p=u.length;r.writeUshort(o,a,i),a+=2,r.writeUshort(o,a,h),a+=2,r.writeUint(o,a,p);let y=[-1,1,1,2,4,8,0,0,0,0,0,0,8][h]*p,m=a+=4;y>4&&(r.writeUint(o,a,c),m=c),"ASCII"===l?r.writeASCII(o,m,u):"SHORT"===l?(0,t.times)(p,e=>{r.writeUshort(o,m+2*e,u[e])}):"LONG"===l?(0,t.times)(p,e=>{r.writeUint(o,m+4*e,u[e])}):"RATIONAL"===l?(0,t.times)(p,e=>{r.writeUint(o,m+8*e,Math.round(1e4*u[e])),r.writeUint(o,m+8*e+4,1e4)}):"DOUBLE"===l&&(0,t.times)(p,e=>{r.writeDouble(o,m+8*e,u[e])}),y>4&&(c+=y+=1&y),a+=4}return[a,c]},c=e=>{const t=new Uint8Array(1e3);let r=4;const o=a;t[0]=77,t[1]=77,t[3]=42;let i=8;if(o.writeUint(t,r,i),r+=4,e.forEach((r,n)=>{const s=l(o,t,i,r);i=s[1],n<e.length-1&&o.writeUint(t,s[0],i)}),t.slice)return t.slice(0,i).buffer;const n=new Uint8Array(i);for(let s=0;s<i;s++)n[s]=t[s];return n.buffer},f=(e,r,o,i)=>{if(null==o)throw new Error(`you passed into encodeImage a width of type ${o}`);if(null==r)throw new Error(`you passed into encodeImage a width of type ${r}`);const n={256:[r],257:[o],273:[1e3],278:[o],305:"geotiff.js"};if(i)for(const t in i)i.hasOwnProperty(t)&&(n[t]=i[t]);const s=new Uint8Array(c([n])),a=new Uint8Array(e),l=n[277],f=new Uint8Array(1e3+r*o*l);return(0,t.times)(s.length,e=>{f[e]=s[e]}),(0,t.forEach)(a,(e,t)=>{f[1e3+t]=e}),f.buffer},h=e=>{const t={};for(const r in e)"StripOffsets"!==r&&(i[r]||console.error(r,"not in name2code:",Object.keys(i)),t[i[r]]=e[r]);return t},u=e=>Array.isArray(e)?e:[e],p=[["Compression",1],["PlanarConfiguration",1],["ExtraSamples",0]];function y(r,o){let n,s,a,l;"number"==typeof r[0]?(n=o.height||o.ImageLength,a=o.width||o.ImageWidth,s=r.length/(n*a),l=r):(s=r.length,n=r[0].length,a=r[0][0].length,l=[],(0,t.times)(n,e=>{(0,t.times)(a,o=>{(0,t.times)(s,t=>{l.push(r[t][e][o])})})})),o.ImageLength=n,delete o.height,o.ImageWidth=a,delete o.width,o.BitsPerSample||(o.BitsPerSample=(0,t.times)(s,()=>8)),p.forEach(e=>{const t=e[0];if(!o[t]){const r=e[1];o[t]=r}}),o.PhotometricInterpretation||(o.PhotometricInterpretation=3===o.BitsPerSample.length?2:1),o.SamplesPerPixel||(o.SamplesPerPixel=[s]),o.StripByteCounts||(o.StripByteCounts=[s*n*a]),o.ModelPixelScale||(o.ModelPixelScale=[360/a,180/n,0]),o.SampleFormat||(o.SampleFormat=(0,t.times)(s,()=>1)),o.hasOwnProperty("GeographicTypeGeoKey")||o.hasOwnProperty("ProjectedCSTypeGeoKey")||(o.GeographicTypeGeoKey=4326,o.ModelTiepoint=[0,0,0,-180,90,0],o.GeogCitationGeoKey="WGS 84",o.GTModelTypeGeoKey=2);const c=Object.keys(o).filter(e=>(0,t.endsWith)(e,"GeoKey")).sort((e,t)=>i[e]-i[t]);if(!o.GeoAsciiParams){let t="";c.forEach(r=>{const n=Number(i[r]);"ASCII"===e.fieldTagTypes[n]&&(t+=`${o[r].toString()}\0`)}),t.length>0&&(o.GeoAsciiParams=t)}if(!o.GeoKeyDirectory){const t=[1,1,0,c.length];c.forEach(r=>{const n=Number(i[r]);let s,a,l;t.push(n),"SHORT"===e.fieldTagTypes[n]?(s=1,a=0,l=o[r]):"GeogCitationGeoKey"===r?(s=o.GeoAsciiParams.length,a=Number(i.GeoAsciiParams),l=0):console.log(`[geotiff.js] couldn't get TIFFTagLocation for ${r}`),t.push(a),t.push(s),t.push(l)}),o.GeoKeyDirectory=t}for(const e in c)c.hasOwnProperty(e)&&delete o[e];["Compression","ExtraSamples","GeographicTypeGeoKey","GTModelTypeGeoKey","GTRasterTypeGeoKey","ImageLength","ImageWidth","Orientation","PhotometricInterpretation","ProjectedCSTypeGeoKey","PlanarConfiguration","ResolutionUnit","SamplesPerPixel","XPosition","YPosition"].forEach(e=>{o[e]&&(o[e]=u(o[e]))});const y=h(o);return f(l,a,n,y)}
},{"./globals":"j27V","./utils":"FOZT"}],"dy4f":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.setLogger=t,exports.debug=n,exports.log=o,exports.info=u,exports.warn=i,exports.error=s,exports.time=f,exports.timeEnd=c;class e{log(){}debug(){}info(){}warn(){}error(){}time(){}timeEnd(){}}let r=new e;function t(t=new e){r=t}function n(...e){return r.debug(...e)}function o(...e){return r.log(...e)}function u(...e){return r.info(...e)}function i(...e){return r.warn(...e)}function s(...e){return r.error(...e)}function f(...e){return r.time(...e)}function c(...e){return r.timeEnd(...e)}
},{}],"bsJs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromUrl=A,exports.fromArrayBuffer=S,exports.fromFile=x,exports.fromBlob=R,exports.fromUrls=U,exports.writeArrayBuffer=q,Object.defineProperty(exports,"Pool",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(exports,"getDecoder",{enumerable:!0,get:function(){return u.getDecoder}}),Object.defineProperty(exports,"addDecoder",{enumerable:!0,get:function(){return u.addDecoder}}),Object.defineProperty(exports,"setLogger",{enumerable:!0,get:function(){return d.setLogger}}),exports.rgb=exports.globals=exports.MultiGeoTIFF=exports.default=exports.GeoTIFF=void 0;var e=y(require("./geotiffimage")),t=y(require("./dataview64")),r=y(require("./dataslice")),i=y(require("./pool")),s=require("./source/remote"),a=require("./source/arraybuffer"),n=require("./source/filereader"),o=require("./source/file"),l=g(require("./globals"));exports.globals=l;var f=require("./geotiffwriter"),c=g(require("./rgb"));exports.rgb=c;var u=require("./compression"),d=require("./logging");function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=h(t);if(r&&r.has(e))return r.get(e);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var n=s?Object.getOwnPropertyDescriptor(e,a):null;n&&(n.get||n.set)?Object.defineProperty(i,a,n):i[a]=e[a]}return i.default=e,r&&r.set(e,i),i}function y(e){return e&&e.__esModule?e:{default:e}}function p(e){switch(e){case l.fieldTypes.BYTE:case l.fieldTypes.ASCII:case l.fieldTypes.SBYTE:case l.fieldTypes.UNDEFINED:return 1;case l.fieldTypes.SHORT:case l.fieldTypes.SSHORT:return 2;case l.fieldTypes.LONG:case l.fieldTypes.SLONG:case l.fieldTypes.FLOAT:case l.fieldTypes.IFD:return 4;case l.fieldTypes.RATIONAL:case l.fieldTypes.SRATIONAL:case l.fieldTypes.DOUBLE:case l.fieldTypes.LONG8:case l.fieldTypes.SLONG8:case l.fieldTypes.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${e}`)}}function w(e){const t=e.GeoKeyDirectory;if(!t)return null;const r={};for(let i=4;i<=4*t[3];i+=4){const s=l.geoKeyNames[t[i]],a=t[i+1]?l.fieldTagNames[t[i+1]]:null,n=t[i+2],o=t[i+3];let f=null;if(a){if(null==(f=e[a]))throw new Error(`Could not get value of geoKey '${s}'.`);"string"==typeof f?f=f.substring(o,o+n-1):f.subarray&&(f=f.subarray(o,o+n),1===n&&(f=f[0]))}else f=o;r[s]=f}return r}function T(e,t,r,i){let s=null,a=null;const n=p(t);switch(t){case l.fieldTypes.BYTE:case l.fieldTypes.ASCII:case l.fieldTypes.UNDEFINED:s=new Uint8Array(r),a=e.readUint8;break;case l.fieldTypes.SBYTE:s=new Int8Array(r),a=e.readInt8;break;case l.fieldTypes.SHORT:s=new Uint16Array(r),a=e.readUint16;break;case l.fieldTypes.SSHORT:s=new Int16Array(r),a=e.readInt16;break;case l.fieldTypes.LONG:case l.fieldTypes.IFD:s=new Uint32Array(r),a=e.readUint32;break;case l.fieldTypes.SLONG:s=new Int32Array(r),a=e.readInt32;break;case l.fieldTypes.LONG8:case l.fieldTypes.IFD8:s=new Array(r),a=e.readUint64;break;case l.fieldTypes.SLONG8:s=new Array(r),a=e.readInt64;break;case l.fieldTypes.RATIONAL:s=new Uint32Array(2*r),a=e.readUint32;break;case l.fieldTypes.SRATIONAL:s=new Int32Array(2*r),a=e.readInt32;break;case l.fieldTypes.FLOAT:s=new Float32Array(r),a=e.readFloat32;break;case l.fieldTypes.DOUBLE:s=new Float64Array(r),a=e.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t!==l.fieldTypes.RATIONAL&&t!==l.fieldTypes.SRATIONAL)for(let o=0;o<r;++o)s[o]=a.call(e,i+o*n);else for(let o=0;o<r;o+=2)s[o]=a.call(e,i+o*n),s[o+1]=a.call(e,i+(o*n+4));return t===l.fieldTypes.ASCII?new TextDecoder("utf-8").decode(s):s}class m{constructor(e,t,r){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=r}}class I extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class b{async readRasters(e={}){const{window:t,width:r,height:i}=e;let{resX:s,resY:a,bbox:n}=e;const o=await this.getImage();let l=o;const f=await this.getImageCount(),c=o.getBoundingBox();if(t&&n)throw new Error('Both "bbox" and "window" passed.');if(r||i){if(t){const[e,r]=o.getOrigin(),[i,s]=o.getResolution();n=[e+t[0]*i,r+t[1]*s,e+t[2]*i,r+t[3]*s]}const e=n||c;if(r){if(s)throw new Error("Both width and resX passed");s=(e[2]-e[0])/r}if(i){if(a)throw new Error("Both width and resY passed");a=(e[3]-e[1])/i}}if(s||a){const e=[];for(let t=0;t<f;++t){const r=await this.getImage(t),{SubfileType:i,NewSubfileType:s}=r.fileDirectory;(0===t||2===i||1&s)&&e.push(r)}e.sort((e,t)=>e.getWidth()-t.getWidth());for(let t=0;t<e.length;++t){const r=e[t],i=(c[2]-c[0])/r.getWidth(),n=(c[3]-c[1])/r.getHeight();if(l=r,s&&s>i||a&&a>n)break}}let u=t;if(n){const[e,t]=o.getOrigin(),[r,i]=l.getResolution(o);u=[Math.round((n[0]-e)/r),Math.round((n[1]-t)/i),Math.round((n[2]-e)/r),Math.round((n[3]-t)/i)],u=[Math.min(u[0],u[2]),Math.min(u[1],u[3]),Math.max(u[0],u[2]),Math.max(u[1],u[3])]}return l.readRasters({...e,window:u})}}class F extends b{constructor(e,t,r,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=r,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const i=this.bigTiff?4048:1024;return new r.default((await this.source.fetch([{offset:e,length:void 0!==t?t:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,r=this.bigTiff?8:2;let i=await this.getSlice(e);const s=this.bigTiff?i.readUint64(e):i.readUint16(e),a=s*t+(this.bigTiff?16:6);i.covers(e,a)||(i=await this.getSlice(e,a));const n={};let o=e+(this.bigTiff?8:2);for(let u=0;u<s;o+=t,++u){const e=i.readUint16(o),t=i.readUint16(o+2),r=this.bigTiff?i.readUint64(o+4):i.readUint32(o+4);let s,a;const f=p(t),c=o+(this.bigTiff?12:8);if(f*r<=(this.bigTiff?8:4))s=T(i,t,r,c);else{const e=i.readOffset(c),a=p(t)*r;if(i.covers(e,a))s=T(i,t,r,e);else{s=T(await this.getSlice(e,a),t,r,e)}}a=1===r&&-1===l.arrayFields.indexOf(e)&&t!==l.fieldTypes.RATIONAL&&t!==l.fieldTypes.SRATIONAL?s[0]:s,n[l.fieldTagNames[e]]=a}const f=w(n),c=i.readOffset(e+r+t*s);return new m(n,f,c)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(0===e)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){if(t instanceof I)throw new I(e);throw t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(0===t.nextIFDByteOffset)throw new I(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(t=0){const r=await this.requestIFD(t);return new e.default(r.fileDirectory,r.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(r){if(!(r instanceof I))throw r;t=!1}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",r=t.length+100;let i=await this.getSlice(e,r);if(t===T(i,l.fieldTypes.ASCII,t.length,e)){const t=T(i,l.fieldTypes.ASCII,r,e).split("\n")[0],s=Number(t.split("=")[1].split(" ")[0])+t.length;s>r&&(i=await this.getSlice(e,s));const a=T(i,l.fieldTypes.ASCII,s,e);this.ghostValues={},a.split("\n").filter(e=>e.length>0).map(e=>e.split("=")).forEach(([e,t])=>{this.ghostValues[e]=t})}return this.ghostValues}static async fromSource(e,r,i){const s=(await e.fetch([{offset:0,length:1024}],i))[0],a=new t.default(s),n=a.getUint16(0,0);let o;if(18761===n)o=!0;else{if(19789!==n)throw new TypeError("Invalid byte order value.");o=!1}const l=a.getUint16(2,o);let f;if(42===l)f=!1;else{if(43!==l)throw new TypeError("Invalid magic number.");if(f=!0,8!==a.getUint16(4,o))throw new Error("Unsupported offset byte-size.")}const c=f?a.getUint64(8,o):a.getUint32(4,o);return new F(e,o,f,c,r)}close(){return"function"==typeof this.source.close&&this.source.close()}}exports.GeoTIFF=F;var D=F;exports.default=D;class O extends b{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(e=>e.parseFileDirectoryAt(e.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(t=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let r=0,i=0;for(let s=0;s<this.imageFiles.length;s++){const a=this.imageFiles[s];for(let n=0;n<this.imageCounts[s];n++){if(t===r){const t=await a.requestIFD(i);return new e.default(t.fileDirectory,t.geoKeyDirectory,a.dataView,a.littleEndian,a.cache,a.source)}r++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(null!==this.imageCount)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(e=>e.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((e,t)=>e+t,0),this.imageCount}}async function A(e,t={},r){return F.fromSource((0,s.makeRemoteSource)(e,t),r)}async function S(e,t){return F.fromSource((0,a.makeBufferSource)(e),t)}async function x(e,t){return F.fromSource((0,o.makeFileSource)(e),t)}async function R(e,t){return F.fromSource((0,n.makeFileReaderSource)(e),t)}async function U(e,t=[],r={},i){const a=await F.fromSource((0,s.makeRemoteSource)(e,r),i),n=await Promise.all(t.map(e=>F.fromSource((0,s.makeRemoteSource)(e,r))));return new O(a,n)}async function q(e,t){return(0,f.writeGeotiff)(e,t)}exports.MultiGeoTIFF=O;
},{"./geotiffimage":"eOWo","./dataview64":"dqpX","./dataslice":"dGLV","./pool":"dHPO","./source/remote":"itmA","./source/arraybuffer":"wM9h","./source/filereader":"GiEG","./source/file":"G7Cz","./globals":"j27V","./geotiffwriter":"BGyE","./rgb":"fpBl","./compression":"FGCZ","./logging":"dy4f"}],"IKSA":[function(require,module,exports) {
"use strict";function e(e,t){let r=e.length-t,o=0;do{for(let r=t;r>0;r--)e[o+t]+=e[o],o++;r-=t}while(r>0)}function t(e,t,r){let o=0,n=e.length;const i=n/r;for(;n>t;){for(let r=t;r>0;--r)e[o+t]+=e[o],++o;n-=t}const l=e.slice();for(let s=0;s<i;++s)for(let t=0;t<r;++t)e[r*s+t]=l[(r-t-1)*i+s]}function r(r,o,n,i,l,s){if(!o||1===o)return r;for(let e=0;e<l.length;++e){if(l[e]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(l[e]!==l[0])throw new Error("When decoding with predictor, all samples must have the same size.")}const a=l[0]/8,c=2===s?1:l.length;for(let f=0;f<i&&!(f*c*n*a>=r.byteLength);++f){let i;if(2===o){switch(l[0]){case 8:i=new Uint8Array(r,f*c*n*a,c*n*a);break;case 16:i=new Uint16Array(r,f*c*n*a,c*n*a/2);break;case 32:i=new Uint32Array(r,f*c*n*a,c*n*a/4);break;default:throw new Error(`Predictor 2 not allowed with ${l[0]} bits per sample.`)}e(i,c,a)}else 3===o&&t(i=new Uint8Array(r,f*c*n*a,c*n*a),c,a)}return r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.applyPredictor=r;
},{}],"FJDe":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("../predictor");class t{async decode(t,r){const i=await this.decodeBlock(r),o=t.Predictor||1;if(1!==o){const r=!t.StripOffsets,s=r?t.TileWidth:t.ImageWidth,a=r?t.TileLength:t.RowsPerStrip||t.ImageLength;return(0,e.applyPredictor)(i,o,s,a,t.BitsPerSample,t.PlanarConfiguration)}return i}}exports.default=t;
},{"../predictor":"IKSA"}],"gIV6":[function(require,module,exports) {
var n=require("fs");module.exports=function(e){return new Promise(function(t,i){n.readFile(__dirname+e,"utf8",function(n,e){n?i(n):setImmediate(function(){t(e)})})}).then(function(n){new Function("",n)()})};
},{}],0:[function(require,module,exports) {
var b=require("TUK3");b.register("js",require("gIV6"));
},{}]},{},[0,"bsJs"], null)
//# sourceMappingURL=/geotiff.js.map