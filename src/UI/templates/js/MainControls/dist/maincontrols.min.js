/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(t,e){"use strict";function s(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=s(t),l=s(e);class n{#t;id;clsBtnEngaged="engaged";clsEntries="il-maincontrols-metabar";clsSlates="il-metabar-slates";clsMoreBtn="il-metabar-more-button";clsMoreSlate="il-metabar-more-slate";clsSingleSlate=il.UI.maincontrols.slate.clsSingleSlate;clsSlateEngaged=il.UI.maincontrols.slate.clsEngaged;propagationStopped;constructor(t,e){this.#t=t,this.id=e}registerSignals(t,e){this.#t(document).on(t,((t,e)=>(this.onClickEntry(t,e),il.UI.page.isSmallScreen()&&il.UI.maincontrols.mainbar&&il.UI.maincontrols.mainbar.disengageAll(),!1))),this.#t(document).on(e,(()=>(this.onClickDisengageAll(),!1))),this.#t(`.${this.clsEntries}`).on("click",(()=>{this.propagationStopped=!0})),this.#t("body").on("click",(()=>{this.propagationStopped?this.propagationStopped=!1:this.onClickDisengageAll()})),this.#t(`.${this.clsSlates} > .${this.clsSingleSlate}`).on("focusout",(t=>{if(!il.UI.page.isSmallScreen()){const e=t.relatedTarget,s=t.currentTarget;this.#t.contains(s,e)||this.onClickDisengageAll()}}))}onClickEntry(t,e){const s=e.triggerer;this.isEngaged(s)?this.disengageButton(s):(this.disengageAllSlates(),this.disengageAllButtons(),0===s.parents(`.${this.clsMoreSlate}`).length&&this.engageButton(s))}onClickDisengageAll(){this.disengageAllButtons(),this.disengageAllSlates()}engageButton(t){t.addClass(this.clsBtnEngaged),t.attr("aria-expanded",!0)}disengageButton(t){t.removeClass(this.clsBtnEngaged),t.attr("aria-expanded",!1)}isEngaged(t){return t.hasClass(this.clsBtnEngaged)}disengageAllButtons(){this.#t(`#${this.id}.${this.clsEntries}`).children("li").children(`.btn.${this.clsBtnEngaged}`).each(((t,e)=>{this.disengageButton(this.#t(e))}))}disengageAllSlates(){this.getEngagedSlates().each(((t,e)=>{il.UI.maincontrols.slate.disengage(this.#t(e))}))}disengageAll(){this.disengageAllSlates(),this.disengageAllButtons()}getEngagedSlates(){const t=`#${this.id} .${this.clsSingleSlate}.${this.clsSlateEngaged}`;return this.#t(t)}init(){this.tagMoreButton(),this.tagMoreSlate(),il.UI.page.isSmallScreen()?this.initCondensed():this.initWide(),this.#t(`.${this.clsEntries}`).css("visibility","visible"),this.#t(`#${this.id} .${this.clsSlates}`).children(`.${this.clsSingleSlate}`).attr("aria-hidden",!0)}initCondensed(){this.initMoreSlate(),this.getMetabarEntries().hide(),this.getMoreButton().show(),this.collectCounters()}initWide(){this.getMoreButton().hide(),this.getMetabarEntries().show()}tagMoreButton(){if(0===this.getMoreButton().length){const t=this.#t(`#${this.id}.${this.clsEntries}`).find(".btn, .il-link").last();this.#t(t).addClass(this.clsMoreBtn)}}tagMoreSlate(){if(0===this.getMoreSlate().length){const t=this.#t(`#${this.id} .${this.clsSlates}`).children(`.${this.clsSingleSlate}`).last();this.#t(t).addClass(this.clsMoreSlate)}}getMoreButton(){return this.#t(`.${this.clsMoreBtn}`)}getMoreSlate(){return this.#t(`.${this.clsMoreSlate}`)}getMetabarEntries(){return this.#t(`#${this.id}.${this.clsEntries}`).children("li").children(".btn, .il-link").not(`.${this.clsMoreBtn}`)}initMoreSlate(){const t=this.getMoreSlate().children(".il-maincontrols-slate-content");0===t.children().length&&this.getMetabarEntries().clone(!0,!0).appendTo(t)}getAllSlates(){return this.#t(`#${this.id} .${this.clsSingleSlate}`).not(`.${this.clsMoreSlate}`)}collectCounters(){const t=il.UI.counter.getCounterObjectOrNull(this.getMoreSlate());t&&il.UI.counter.getCounterObject(this.getMoreButton()).setNoveltyTo(t.getNoveltyCount()).setStatusTo(t.getStatusCount())}}i.default.UI=i.default.UI||{},i.default.UI.table=i.default.UI.table||{},i.default.UI.maincontrols=i.default.UI.maincontrols||{},i.default.UI.maincontrols.metabar=new class{#t;#e=[];constructor(t){this.#t=t}init(t){if(void 0!==this.#e[t])throw new Error(`Metabar with id '${t}' has already been initialized.`);this.#e[t]=new n(this.#t,t)}get(t){return this.#e[t]??null}disengageAll(){Object.values(this.#e).forEach((t=>t.disengageAll()))}}(l.default),i.default.UI.maincontrols.slate=new class{#t;clsEngaged="engaged";clsDisEngaged="disengaged";clsSingleSlate="il-maincontrols-slate";constructor(t){this.#t=t}onSignal(t,e,s,i){const l=this.#t(`#${i}`),{triggerer:n}=s,a=n.parents(".il-metabar-more-slate").length>0;if("toggle"===t)this.onToggleSignal(l,n,a);else if("engage"===t)this.engage(l);else{if("replace"!==t)throw new Error(`No such SignalType: ${t}`);this.replaceFromSignal(i,s)}}onToggleSignal(t,e,s){const i=t.closest(".il-maincontrols-metabar").attr("id"),l=il.UI.maincontrols.metabar.get(i);e.attr("id")!==l.getMoreButton().attr("id")?(this.toggle(t),s||(this.isEngaged(t)?(e.addClass(this.clsEngaged),e.removeClass(this.clsDisEngaged),t.trigger("in_view")):(e.removeClass(this.clsEngaged),e.addClass(this.clsDisEngaged)))):l.getEngagedSlates().length>0?l.disengageAllSlates():this.toggle(t)}toggle(t){this.isEngaged(t)?this.disengage(t):this.engage(t)}isEngaged(t){return t.hasClass(this.clsEngaged)}engage(t){t.removeClass(this.clsDisEngaged),t.addClass(this.clsEngaged),t.attr("aria-expanded","true"),t.attr("aria-hidden","false")}disengage(t){t.removeClass(this.clsEngaged),t.addClass(this.clsDisEngaged),t.attr("aria-expanded","false"),t.attr("aria-hidden","true")}replaceFromSignal(t,e){const{url:s}=e.options;il.UI.core.replaceContent(this.id,s,"content")}}(l.default)}(il,$);
