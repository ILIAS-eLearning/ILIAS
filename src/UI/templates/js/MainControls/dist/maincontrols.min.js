/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(t,e){"use strict";function s(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=s(t),a=s(e);class n{#t;id;classForBtnEngaged="engaged";classForEntries="il-maincontrols-metabar";classForSlates="il-metabar-slates";classForMoreBtn="il-metabar-more-button";classForMoreSlate="il-metabar-more-slate";classForSingleSlate=il.UI.maincontrols.slate.classForSingleSlate;classForSlateEngaged=il.UI.maincontrols.slate.classForEngaged;propagationStopped;constructor(t,e){this.#t=t,this.id=e}registerSignals(t,e){this.#t(document).on(t,((t,e)=>(this.onClickEntry(t,e),il.UI.page.isSmallScreen()&&il.UI.maincontrols.mainbar&&il.UI.maincontrols.mainbar.disengageAll(),!1))),this.#t(document).on(e,(()=>(this.onClickDisengageAll(),!1))),this.#t(`.${this.classForEntries}`).on("click",(()=>{this.propagationStopped=!0})),this.#t("body").on("click",(()=>{this.propagationStopped?this.propagationStopped=!1:this.onClickDisengageAll()})),this.#t(`.${this.classForSlates} > .${this.classForSingleSlate}`).on("focusout",(t=>{if(!il.UI.page.isSmallScreen()){const e=t.relatedTarget,s=t.currentTarget;this.#t.contains(s,e)||this.onClickDisengageAll()}}))}onClickEntry(t,e){const s=e.triggerer;this.isEngaged(s)?this.disengageButton(s):(this.disengageAllSlates(),this.disengageAllButtons(),0===s.parents(`.${this.classForMoreSlate}`).length&&this.engageButton(s))}onClickDisengageAll(){this.disengageAllButtons(),this.disengageAllSlates()}engageButton(t){t.addClass(this.classForBtnEngaged),t.attr("aria-expanded",!0)}disengageButton(t){t.removeClass(this.classForBtnEngaged),t.attr("aria-expanded",!1)}isEngaged(t){return t.hasClass(this.classForBtnEngaged)}disengageAllButtons(){this.#t(`#${this.id}.${this.classForEntries}`).children("li").children(`.btn.${this.classForBtnEngaged}`).each(((t,e)=>{this.disengageButton(this.#t(e))}))}disengageAllSlates(){this.getEngagedSlates().each(((t,e)=>{il.UI.maincontrols.slate.disengage(this.#t(e))}))}disengageAll(){this.disengageAllSlates(),this.disengageAllButtons()}getEngagedSlates(){const t=`#${this.id} .${this.classForSingleSlate}.${this.classForSlateEngaged}`;return this.#t(t)}init(){this.tagMoreButton(),this.tagMoreSlate(),il.UI.page.isSmallScreen()?this.initCondensed():this.initWide(),this.#t(`.${this.classForEntries}`).css("visibility","visible"),this.#t(`#${this.id} .${this.classForSlates}`).children(`.${this.classForSingleSlate}`).attr("aria-hidden",!0)}initCondensed(){this.initMoreSlate(),this.getMetabarEntries().hide(),this.getMoreButton().show(),this.collectCounters()}initWide(){this.getMoreButton().hide(),this.getMetabarEntries().show()}tagMoreButton(){if(0===this.getMoreButton().length){const t=this.#t(`#${this.id}.${this.classForEntries}`).find(".btn, .il-link").last();this.#t(t).addClass(this.classForMoreBtn)}}tagMoreSlate(){if(0===this.getMoreSlate().length){const t=this.#t(`#${this.id} .${this.classForSlates}`).children(`.${this.classForSingleSlate}`).last();this.#t(t).addClass(this.classForMoreSlate)}}getMoreButton(){return this.#t(`.${this.classForMoreBtn}`)}getMoreSlate(){return this.#t(`.${this.classForMoreSlate}`)}getMetabarEntries(){return this.#t(`#${this.id}.${this.classForEntries}`).children("li").children(".btn, .il-link").not(`.${this.classForMoreBtn}`)}initMoreSlate(){const t=this.getMoreSlate().children(".il-maincontrols-slate-content");0===t.children().length&&this.getMetabarEntries().clone(!0,!0).appendTo(t)}getAllSlates(){return this.#t(`#${this.id} .${this.classForSingleSlate}`).not(`.${this.classForMoreSlate}`)}collectCounters(){const t=il.UI.counter.getCounterObjectOrNull(this.getMoreSlate());t&&il.UI.counter.getCounterObject(this.getMoreButton()).setNoveltyTo(t.getNoveltyCount()).setStatusTo(t.getStatusCount())}}i.default.UI=i.default.UI||{},i.default.UI.maincontrols=i.default.UI.maincontrols||{},i.default.UI.maincontrols.metabar=new class{#t;#e=[];constructor(t){this.#t=t}init(t){if(void 0!==this.#e[t])throw new Error(`Metabar with id '${t}' has already been initialized.`);this.#e[t]=new n(this.#t,t)}get(t){return this.#e[t]??null}disengageAll(){Object.values(this.#e).forEach((t=>t.disengageAll()))}}(a.default),i.default.UI.maincontrols.slate=new class{#t;classForEngaged="engaged";classForDisEngaged="disengaged";classForSingleSlate="il-maincontrols-slate";replacementType="content";constructor(t){this.#t=t}onSignal(t,e,s,i){const a=this.#t(`#${i}`),{triggerer:n}=s,l=n.parents(".il-metabar-more-slate").length>0;if("toggle"===t)this.onToggleSignal(a,n,l);else if("engage"===t)this.engage(a);else{if("replace"!==t)throw new Error(`No such SignalType: ${t}`);this.replaceFromSignal(i,s)}}onToggleSignal(t,e,s){const i=t.closest(".il-maincontrols-metabar").attr("id"),a=il.UI.maincontrols.metabar.get(i);e.attr("id")!==a.getMoreButton().attr("id")?(this.toggle(t),s||(this.isEngaged(t)?(e.addClass(this.classForEngaged),e.removeClass(this.classForDisEngaged),t.trigger("in_view")):(e.removeClass(this.classForEngaged),e.addClass(this.classForDisEngaged)))):a.getEngagedSlates().length>0?a.disengageAllSlates():this.toggle(t)}toggle(t){this.isEngaged(t)?this.disengage(t):this.engage(t)}isEngaged(t){return t.hasClass(this.classForEngaged)}engage(t){t.removeClass(this.classForDisEngaged),t.addClass(this.classForEngaged),t.attr("aria-expanded","true"),t.attr("aria-hidden","false")}disengage(t){t.removeClass(this.classForEngaged),t.addClass(this.classForDisEngaged),t.attr("aria-expanded","false"),t.attr("aria-hidden","true")}replaceFromSignal(t,e){const{url:s}=e.options;il.UI.core.replaceContent(t,s,this.replacementType)}}(a.default)}(il,$);
