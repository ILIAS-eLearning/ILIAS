/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(t,e){"use strict";function s(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=s(t),a=s(e);class i{#t;#e;#s="engaged";#n="il-maincontrols-metabar";#a="il-metabar-slates";#i="il-metabar-more-button";#o="il-metabar-more-slate";#r="il-maincontrols-slate";#l="engaged";#c;#h;#g;#u;#d;constructor(t,e,s,n,a,i){this.#t=t,this.#e=e,this.#h=s,this.#g=n,this.#u=a,this.#d=i}registerSignals(t,e){this.#t(document).on(t,((t,e)=>(this.#S(t,e),this.#h()&&this.#u(),!1))),this.#t(document).on(e,(()=>(this.onClickDisengageAll(),!1))),this.#t(`.${this.#n}`).on("click",(()=>{this.#c=!0})),this.#t("body").on("click",(()=>{this.#c?this.#c=!1:this.onClickDisengageAll()})),this.#t(`.${this.#a} > .${this.#r}`).on("focusout",(t=>{if(!this.#h()){const e=t.relatedTarget,s=t.currentTarget;this.#t.contains(s,e)||this.onClickDisengageAll()}}))}#S(t,e){const s=e.triggerer;this.#y(s)?this.#f(s):(this.disengageAllSlates(),this.disengageAllButtons(),0===s.parents(`.${this.#o}`).length&&this.#m(s))}onClickDisengageAll(){this.disengageAllButtons(),this.disengageAllSlates()}#m(t){t.addClass(this.#s),t.attr("aria-expanded",!0)}#f(t){t.removeClass(this.#s),t.attr("aria-expanded",!1)}#y(t){return t.hasClass(this.#s)}disengageAllButtons(){this.#t(`#${this.#e}.${this.#n}`).children("li").children(`.btn.${this.#s}`).each(((t,e)=>{this.#f(this.#t(e))}))}disengageAllSlates(){this.getEngagedSlates().each(((t,e)=>{this.#d(this.#t(e))}))}disengageAll(){this.disengageAllSlates(),this.disengageAllButtons()}getEngagedSlates(){const t=`#${this.#e} .${this.#r}.${this.#l}`;return this.#t(t)}init(){this.#b(),this.#p(),this.#h()?this.#C():this.#v(),this.#t(`.${this.#n}`).css("visibility","visible"),this.#t(`#${this.#e} .${this.#a}`).children(`.${this.#r}`).attr("aria-hidden",!0)}#C(){this.#j(),this.#F().hide(),this.getMoreButton().show(),this.#E()}#v(){this.getMoreButton().hide(),this.#F().show()}#b(){if(0===this.getMoreButton().length){const t=this.#t(`#${this.#e}.${this.#n}`).find(".btn, .il-link").last();this.#t(t).addClass(this.#i)}}#p(){if(0===this.#N().length){const t=this.#t(`#${this.#e} .${this.#a}`).children(`.${this.#r}`).last();this.#t(t).addClass(this.#o)}}getMoreButton(){return this.#t(`.${this.#i}`)}#N(){return this.#t(`.${this.#o}`)}#F(){return this.#t(`#${this.#e}.${this.#n}`).children("li").children(".btn, .il-link").not(`.${this.#i}`)}#j(){const t=this.#N().children(".il-maincontrols-slate-content");0===t.children().length&&this.#F().clone(!0,!0).appendTo(t)}#E(){window.top.x=this.#g;const t=this.#g.getCounterObjectOrNull(this.#N());t&&this.#g.getCounterObject(this.getMoreButton()).setNoveltyTo(t.getNoveltyCount()).setStatusTo(t.getStatusCount())}}var o=function(t){var e="il-counter",s={getCounterObject:function(t){let e;return e=n(t),console.assert(e.length>0,"Passed jQuery Object does not contain a counter"),a(e)},getCounterObjectOrNull:function(t){let e;return e=n(t),0===e.length?null:a(e)}},n=function(s){console.assert(s instanceof t,"$object_containing_counter is not a jQuery Object, param: "+s);var n=s;return s.hasClass(e)||(n=s.find("."+e)),n},a=function(e){return r.bind({})(e,t)};return s},r=function(t,e){const s=" Counter does not exist in the DOM. Make sure the respective Counter type has been rendered before applying this operations.",n=" is not a number";this.getStatusCount=function(){return l(r(t))},this.getNoveltyCount=function(){return l(i(t))},this.hasNoveltyObject=function(){return i(t).length>0},this.hasStatusObject=function(){return r(t).length>0},this.setNoveltyTo=function(e){console.assert(this.hasNoveltyObject(),"Novelty "+s),console.assert("number"==typeof e,e+n);var a=i(t);return a.html(e),0===e?a.hide():a.show(),this},this.setStatusTo=function(e){console.assert(this.hasStatusObject(),"Status "+s),console.assert("number"==typeof e,e+n);var a=r(t);return a.html(e),0===e?a.hide():a.show(),this},this.incrementNoveltyCount=function(e){return console.assert(this.hasNoveltyObject(),"Novelty "+s),console.assert("number"==typeof e,e+n),c((function(t){t.hasNoveltyObject()&&t.setNoveltyTo(t.getNoveltyCount()+e)}),t),this},this.decrementNoveltyCount=function(e){return console.assert(this.hasNoveltyObject(),"Novelty "+s),console.assert("number"==typeof e,e+n),c((function(t){t.hasNoveltyObject()&&t.setNoveltyTo(t.getNoveltyCount()-e)}),t),this},this.incrementStatusCount=function(e){return console.assert(this.hasStatusObject(),"Status "+s),console.assert("number"==typeof e,e+n),c((function(t){t.hasStatusObject()&&t.setStatusTo(t.getStatusCount()+e)}),t),this},this.decrementStatusCount=function(e){return console.assert(this.hasStatusObject(),"Status "+s),console.assert("number"==typeof e,e+n),c((function(t){t.hasStatusObject()&&t.setStatusTo(t.getStatusCount()-e)}),t),this},this.setTotalNoveltyToStatusCount=function(){return console.assert(this.hasStatusObject(),"Status "+s),console.assert(this.hasNoveltyObject(),"Novelty "+s),this.incrementStatusCount(this.getNoveltyCount()).setNoveltyTo(0)};var a={getNoveltyCount:this.getNoveltyCount,getStatusCount:this.getStatusCount,hasNoveltyObject:this.hasNoveltyObject,hasStatusObject:this.hasStatusObject,setNoveltyTo:this.setNoveltyTo,setStatusTo:this.setStatusTo,incrementNoveltyCount:this.incrementNoveltyCount,decrementNoveltyCount:this.decrementNoveltyCount,incrementStatusCount:this.incrementStatusCount,decrementStatusCount:this.decrementStatusCount,setTotalNoveltyToStatusCount:this.setTotalNoveltyToStatusCount},i=function(t){return t.find(".il-counter-novelty")},r=function(t){return t.find(".il-counter-status")},l=function(t){var s=0;return t.each((function(){var t=e(this).text();s+=parseInt(t)})),s},c=function(t,s){s.each((function(){var s=o(e).getCounterObject(e(this));t(s,e(this))}))};return a};n.default.UI=n.default.UI||{},n.default.UI.maincontrols=n.default.UI.maincontrols||{},n.default.UI.maincontrols.metabar=new class{#t;#M=[];#h;#g;#u;#d;constructor(t,e,s,n,a){this.#t=t,this.#h=e,this.#g=s,this.#u=n,this.#d=a}init(t){if(void 0!==this.#M[t])throw new Error(`Metabar with id '${t}' has already been initialized.`);this.#M[t]=new i(this.#t,t,this.#h,this.#g,this.#u,this.#d)}get(t){return this.#M[t]??null}disengageAll(){Object.values(this.#M).forEach((t=>t.disengageAll()))}}(a.default,n.default.UI.page.isSmallScreen,o(a.default),(()=>n.default.UI.maincontrols.mainbar.disengageAll()),(t=>n.default.UI.maincontrols.slate.disengage(t))),n.default.UI.maincontrols.slate=new class{#t;#O="engaged";#$="disengaged";#r="il-maincontrols-slate";#T="content";#q;#B;constructor(t,e,s){this.#t=t,this.#q=e,this.#B=s}onSignal(t,e,s,n){const a=this.#t(`#${n}`),{triggerer:i}=s,o=i.parents(".il-metabar-more-slate").length>0;if("toggle"===t)this.#I(a,i,o);else if("engage"===t)this.#A(a);else{if("replace"!==t)throw new Error(`No such SignalType: ${t}`);this.#k(n,s)}}#I(t,e,s){const n=t.closest(".il-maincontrols-metabar").attr("id"),a=this.#B.get(n);e.attr("id")!==a.getMoreButton().attr("id")?(this.#w(t),s||(this.#y(t)?(e.addClass(this.#O),e.removeClass(this.#$),t.trigger("in_view")):(e.removeClass(this.#O),e.addClass(this.#$)))):a.getEngagedSlates().length>0?a.disengageAllSlates():this.#w(t)}#w(t){this.#y(t)?this.disengage(t):this.#A(t)}#y(t){return t.hasClass(this.#O)}#A(t){t.removeClass(this.#$),t.addClass(this.#O),t.attr("aria-expanded","true"),t.attr("aria-hidden","false")}disengage(t){t.removeClass(this.#O),t.addClass(this.#$),t.attr("aria-expanded","false"),t.attr("aria-hidden","true")}#k(t,e){const{url:s}=e.options;this.#q(t,s,this.#T)}}(a.default,function(t){return function(e,s,n){t.ajax({url:s,dataType:"html"}).done((function(s){var a=t("<div>"+s+"</div>"),i=a.find("[data-replace-marker='"+n+"']").first();0==i.length?t("#"+e+" [data-replace-marker='"+n+"']").html(s):(t("#"+e+" [data-replace-marker='"+n+"']").first().replaceWith(i),t("#"+e+" [data-replace-marker='"+n+"']").first().after(a.find("[data-replace-marker='script']")))}))}}(a.default),n.default.UI.maincontrols.metabar)}(il,$);
